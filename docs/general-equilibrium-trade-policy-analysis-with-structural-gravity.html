<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 General equilibrium trade policy analysis with structural gravity | Solutions Manual for An Advanced Guide to Trade Policy Analysis in R</title>
  <meta name="description" content="Chapter 3 General equilibrium trade policy analysis with structural gravity | Solutions Manual for An Advanced Guide to Trade Policy Analysis in R" />
  <meta name="generator" content="bookdown 0.28 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 General equilibrium trade policy analysis with structural gravity | Solutions Manual for An Advanced Guide to Trade Policy Analysis in R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 General equilibrium trade policy analysis with structural gravity | Solutions Manual for An Advanced Guide to Trade Policy Analysis in R" />
  
  
  

<meta name="author" content="Mauricio “Pachá” Vargas Sepúlveda" />


<meta name="date" content="2022-09-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"/>
<link rel="next" href="data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.24/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Solutions Manual for An Advanced Guide to Trade Policy Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#welcome"><i class="fa fa-check"></i><b>1.1</b> Welcome</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#disclaimer"><i class="fa fa-check"></i><b>1.2</b> Disclaimer</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#reproducing-agtpa-results-yourself"><i class="fa fa-check"></i><b>1.3</b> Reproducing AGTPA results yourself</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#getting-the-most-out-of-this-material"><i class="fa fa-check"></i><b>1.4</b> Getting the most out of this material</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i><b>1.5</b> Acknowledgments</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#changes-concerning-the-first-edition"><i class="fa fa-check"></i><b>1.6</b> Changes concerning the first edition</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#contact"><i class="fa fa-check"></i><b>1.7</b> Contact</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><i class="fa fa-check"></i><b>2</b> Partial equilibrium trade policy analysis with structural gravity</a>
<ul>
<li class="chapter" data-level="2.1" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#traditional-gravity-estimates"><i class="fa fa-check"></i><b>2.1</b> Traditional Gravity Estimates</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#preparing-the-data"><i class="fa fa-check"></i><b>2.1.1</b> Preparing the data</a></li>
<li class="chapter" data-level="2.1.2" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ols-estimation-ignoring-multilateral-resistance-terms"><i class="fa fa-check"></i><b>2.1.2</b> OLS estimation ignoring multilateral resistance terms</a></li>
<li class="chapter" data-level="2.1.3" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ols-estimation-controlling-for-multilateral-resistance-terms-with-remote-indexes"><i class="fa fa-check"></i><b>2.1.3</b> OLS estimation controlling for multilateral resistance terms with remote indexes</a></li>
<li class="chapter" data-level="2.1.4" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ols-estimation-controlling-for-multilateral-resistance-terms-with-fixed-effects"><i class="fa fa-check"></i><b>2.1.4</b> OLS estimation controlling for multilateral resistance terms with fixed effects</a></li>
<li class="chapter" data-level="2.1.5" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ppml-estimation-controlling-for-multilateral-resistance-terms-with-fixed-effects"><i class="fa fa-check"></i><b>2.1.5</b> PPML estimation controlling for multilateral resistance terms with fixed effects</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#the-distance-puzzle-resolved"><i class="fa fa-check"></i><b>2.2</b> The “distance puzzle” resolved</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#preparing-the-data-1"><i class="fa fa-check"></i><b>2.2.1</b> Preparing the data</a></li>
<li class="chapter" data-level="2.2.2" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ols-solution-for-the-distance-puzzle"><i class="fa fa-check"></i><b>2.2.2</b> OLS solution for the “distance puzzle”</a></li>
<li class="chapter" data-level="2.2.3" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ppml-solution-for-the-distance-puzzle"><i class="fa fa-check"></i><b>2.2.3</b> PPML solution for the “distance puzzle”</a></li>
<li class="chapter" data-level="2.2.4" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#internal-distance-solution-for-the-distance-puzzle"><i class="fa fa-check"></i><b>2.2.4</b> Internal distance solution for the “distance puzzle”</a></li>
<li class="chapter" data-level="2.2.5" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#internal-distance-and-home-bias-solution-for-the-distance-puzzle"><i class="fa fa-check"></i><b>2.2.5</b> Internal distance and home bias solution for the “distance puzzle”</a></li>
<li class="chapter" data-level="2.2.6" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#fixed-effects-solution-for-the-distance-puzzle"><i class="fa fa-check"></i><b>2.2.6</b> Fixed effects solution for the “distance puzzle”</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#regional-trade-agreements-effects"><i class="fa fa-check"></i><b>2.3</b> Regional trade agreements effects</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#preparing-the-data-2"><i class="fa fa-check"></i><b>2.3.1</b> Preparing the data</a></li>
<li class="chapter" data-level="2.3.2" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ols-standard-rta-estimates-with-international-trade-only"><i class="fa fa-check"></i><b>2.3.2</b> OLS standard RTA estimates with international trade only</a></li>
<li class="chapter" data-level="2.3.3" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ppml-standard-rta-estimates-with-international-trade-only"><i class="fa fa-check"></i><b>2.3.3</b> PPML standard RTA estimates with international trade only</a></li>
<li class="chapter" data-level="2.3.4" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#addressing-potential-domestic-trade-diversion"><i class="fa fa-check"></i><b>2.3.4</b> Addressing potential domestic trade diversion</a></li>
<li class="chapter" data-level="2.3.5" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#addressing-potential-endogeneity-of-rtas"><i class="fa fa-check"></i><b>2.3.5</b> Addressing potential endogeneity of RTAs</a></li>
<li class="chapter" data-level="2.3.6" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#testing-for-potential-reverse-causality-between-trade-and-rtas"><i class="fa fa-check"></i><b>2.3.6</b> Testing for potential “reverse causality” between trade and RTAs</a></li>
<li class="chapter" data-level="2.3.7" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#addressing-potential-non-linear-and-phasing-in-effects-of-rtas"><i class="fa fa-check"></i><b>2.3.7</b> Addressing potential non-linear and phasing-in effects of RTAs</a></li>
<li class="chapter" data-level="2.3.8" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#addressing-globalization-effects"><i class="fa fa-check"></i><b>2.3.8</b> Addressing globalization effects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><i class="fa fa-check"></i><b>3</b> General equilibrium trade policy analysis with structural gravity</a>
<ul>
<li class="chapter" data-level="3.1" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#trade-without-borders"><i class="fa fa-check"></i><b>3.1</b> Trade without borders</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#initial-data"><i class="fa fa-check"></i><b>3.1.1</b> Initial data</a></li>
<li class="chapter" data-level="3.1.2" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-i-solve-the-baseline-model"><i class="fa fa-check"></i><b>3.1.2</b> Step I: Solve the baseline model</a></li>
<li class="chapter" data-level="3.1.3" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-ii-define-a-counterfactual-scenario"><i class="fa fa-check"></i><b>3.1.3</b> Step II: Define a counterfactual scenario</a></li>
<li class="chapter" data-level="3.1.4" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-iii-solve-the-counterfactual-model"><i class="fa fa-check"></i><b>3.1.4</b> Step III: Solve the counterfactual model</a></li>
<li class="chapter" data-level="3.1.5" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-iv-collect-construct-and-report-indexes-of-interest"><i class="fa fa-check"></i><b>3.1.5</b> Step IV: Collect, construct, and report indexes of interest</a></li>
<li class="chapter" data-level="3.1.6" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#figures-replication"><i class="fa fa-check"></i><b>3.1.6</b> Figures replication</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#impact-of-regional-trade-agreements"><i class="fa fa-check"></i><b>3.2</b> Impact of regional trade agreements</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#initial-data-1"><i class="fa fa-check"></i><b>3.2.1</b> Initial data</a></li>
<li class="chapter" data-level="3.2.2" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-1-solve-the-baseline-gravity-model"><i class="fa fa-check"></i><b>3.2.2</b> Step 1: Solve the baseline gravity model</a></li>
<li class="chapter" data-level="3.2.3" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-ii-define-a-counterfactual-scenario-1"><i class="fa fa-check"></i><b>3.2.3</b> Step II: Define a counterfactual scenario</a></li>
<li class="chapter" data-level="3.2.4" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-iii-solve-the-counterfactual-model-1"><i class="fa fa-check"></i><b>3.2.4</b> Step III: Solve the counterfactual model</a></li>
<li class="chapter" data-level="3.2.5" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-iv-collect-construct-and-report-indexes-of-interest-1"><i class="fa fa-check"></i><b>3.2.5</b> Step IV: Collect, construct, and report indexes of interest</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>4</b> Appendix: Importing the original datasets</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data.html"><a href="data.html#downloading-the-original-datasets"><i class="fa fa-check"></i><b>4.1</b> Downloading the original datasets</a></li>
<li class="chapter" data-level="4.2" data-path="data.html"><a href="data.html#converting-the-original-datasets"><i class="fa fa-check"></i><b>4.2</b> Converting the original datasets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://www.unescap.org/" target="blank">UN ESCAP - Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Solutions Manual for An Advanced Guide to Trade Policy Analysis in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="general-equilibrium-trade-policy-analysis-with-structural-gravity" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> General equilibrium trade policy analysis with structural gravity<a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#general-equilibrium-trade-policy-analysis-with-structural-gravity" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="trade-without-borders" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Trade without borders<a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#trade-without-borders" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="initial-data" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Initial data<a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#initial-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Unlike the previous chapter, we shall proceed by alternating both data transforming and regressions. In the previous chapter, it was possible first to process the datasets and then fit the regressions, but here we need the regressions’ output to create new variables. In any case, we will follow quite similar steps to the last chapter.</p>
<p>To do what is shown in box #1 from page 104 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span>, we need to convert “DEU” in both exporter and importer columns to “0-DEU” so that the software sets it as the reference factor (i.e., “0-DEU” will be listed before any text string starting with a letter). The book uses “ZZZ,” but in R, “ZZZ” will not be treated as the reference factor, for which case we could have used “AAA.” It is important to mention that box #1 does not show a previous step to filter observations for 2006, which is mentioned on page 103.</p>
<p>It is imperative to arrange the table by importers. Otherwise, there is a difference in the estimated fixed effects that changes the factory prices in the last figure from this section, and here the aim is to fully replicate the two figures from this section in the book. We mentioned this in the RTA effects section from the previous chapter.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-1" aria-hidden="true" tabindex="-1"></a>ch2_application1 <span class="ot">&lt;-</span> agtpa_applications <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(exporter, importer, pair_id, year, trade, dist, cntg, lang, clny) <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2006</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb50-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_dist =</span> <span class="fu">log</span>(dist),</span>
<span id="cb50-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">intl =</span> <span class="fu">ifelse</span>(exporter <span class="sc">!=</span> importer, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb50-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">exporter =</span> <span class="fu">ifelse</span>(exporter <span class="sc">==</span> <span class="st">&quot;DEU&quot;</span>, <span class="st">&quot;0-DEU&quot;</span>, exporter),</span>
<span id="cb50-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">importer =</span> <span class="fu">ifelse</span>(importer <span class="sc">==</span> <span class="st">&quot;DEU&quot;</span>, <span class="st">&quot;0-DEU&quot;</span>, importer)</span>
<span id="cb50-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb50-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(importer) <span class="sc">%&gt;%</span> </span>
<span id="cb50-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create Yit</span></span>
<span id="cb50-13"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(exporter) <span class="sc">%&gt;%</span></span>
<span id="cb50-14"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">sum</span>(trade)) <span class="sc">%&gt;%</span></span>
<span id="cb50-15"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-16"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create Eit</span></span>
<span id="cb50-17"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(importer) <span class="sc">%&gt;%</span></span>
<span id="cb50-18"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">e =</span> <span class="fu">sum</span>(trade)) <span class="sc">%&gt;%</span></span>
<span id="cb50-19"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-20"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create Er</span></span>
<span id="cb50-21"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb50-22"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb50-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">e_r =</span> <span class="fu">max</span>(<span class="fu">ifelse</span>(importer <span class="sc">==</span> <span class="st">&quot;0-DEU&quot;</span>, e, <span class="cn">NA</span>), <span class="at">na.rm =</span> T))</span></code></pre></div>
</div>
<div id="step-i-solve-the-baseline-model" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Step I: Solve the baseline model<a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-i-solve-the-baseline-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We start by fitting the model</p>
<p><span class="math display">\[
\begin{align}
X_{ij,t} =&amp; \:\exp\left[\pi_{i,t} + \chi_{i,t} + \beta_1 \log(DIST)_{i,j} + \beta_2 CNTG_{i,j} + \beta_3 INTL_{i,j}\right] \times \varepsilon_{ij,t}.
\end{align}
\]</span></p>
<p>With the data from above, the model specification is straightforward.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb51-1" aria-hidden="true" tabindex="-1"></a>fit_baseline_app1 <span class="ot">&lt;-</span> <span class="fu">fepois</span>(</span>
<span id="cb51-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb51-2" aria-hidden="true" tabindex="-1"></a>  trade <span class="sc">~</span> log_dist <span class="sc">+</span> cntg <span class="sc">+</span> intl <span class="sc">|</span> exporter <span class="sc">+</span> importer,</span>
<span id="cb51-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ch2_application1,</span>
<span id="cb51-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">glm.iter =</span> <span class="dv">500</span></span>
<span id="cb51-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb51-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>With the estimated model, we can proceed as in box #1 from page 105 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span> to construct the variables for exporter and importer fixed effects. This step is very different compared to Stata.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb52-1" aria-hidden="true" tabindex="-1"></a>ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb52-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb52-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">fe_exporter_bln =</span> <span class="fu">fixef</span>(fit_baseline_app1)<span class="sc">$</span>exporter[exporter],</span>
<span id="cb52-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fe_importer_bln =</span> <span class="fu">fixef</span>(fit_baseline_app1)<span class="sc">$</span>importer[importer]</span>
<span id="cb52-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb52-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Still following box #1, we need to compute the variables of bilateral trade costs and multilateral resistances.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb53-1" aria-hidden="true" tabindex="-1"></a>ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb53-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">tij_bln =</span> <span class="fu">exp</span>(fit_baseline_app1<span class="sc">$</span>coefficients[<span class="st">&quot;log_dist&quot;</span>] <span class="sc">*</span> log_dist <span class="sc">+</span></span>
<span id="cb53-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb53-4" aria-hidden="true" tabindex="-1"></a>                  fit_baseline_app1<span class="sc">$</span>coefficients[<span class="st">&quot;cntg&quot;</span>] <span class="sc">*</span> cntg <span class="sc">+</span></span>
<span id="cb53-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb53-5" aria-hidden="true" tabindex="-1"></a>                  fit_baseline_app1<span class="sc">$</span>coefficients[<span class="st">&quot;intl&quot;</span>] <span class="sc">*</span> intl),</span>
<span id="cb53-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># outward multilateral resistance (omr)</span></span>
<span id="cb53-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">omr_bln =</span> y <span class="sc">*</span> (e_r <span class="sc">/</span> <span class="fu">exp</span>(fe_exporter_bln)),</span>
<span id="cb53-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># inward multilateral resistance (imr)</span></span>
<span id="cb53-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb53-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">imr_bln =</span> e <span class="sc">/</span> (<span class="fu">exp</span>(fe_importer_bln) <span class="sc">*</span> e_r)</span>
<span id="cb53-12"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb53-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>To complete this estimation stage, we need to create a column with the estimated international trade for given output and expenditures. We start by adding a column with the estimated trade for the baseline model, and then we group by the exporter and summarise to obtain the required column <span class="math inline">\(\xi\)</span>-baseline.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb54-1" aria-hidden="true" tabindex="-1"></a>ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(tradehat_bln = predict(fit_baseline_app1, ch2_application1, &quot;response&quot;)) %&gt;%</span></span>
<span id="cb54-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tradehat_bln =</span> <span class="fu">predict</span>(fit_baseline_app1, ch2_application1)) <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(exporter) <span class="sc">%&gt;%</span></span>
<span id="cb54-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xi_bln =</span> <span class="fu">sum</span>(tradehat_bln <span class="sc">*</span> (exporter <span class="sc">!=</span> importer))) <span class="sc">%&gt;%</span></span>
<span id="cb54-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
<div id="step-ii-define-a-counterfactual-scenario" class="section level3 hasAnchor" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Step II: Define a counterfactual scenario<a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-ii-define-a-counterfactual-scenario" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Box #2 from page 105 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span> proposes two alternatives to define the counterfactual scenario of removing international borders. The first alternative is to eliminate the border variable and generate the logged trade costs used in the constraint.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb55-1" aria-hidden="true" tabindex="-1"></a>ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb55-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">tij_cfl =</span> <span class="fu">exp</span>(fit_baseline_app1<span class="sc">$</span>coefficients[<span class="st">&quot;log_dist&quot;</span>] <span class="sc">*</span> log_dist <span class="sc">+</span></span>
<span id="cb55-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb55-4" aria-hidden="true" tabindex="-1"></a>                  fit_baseline_app1<span class="sc">$</span>coefficients[<span class="st">&quot;cntg&quot;</span>] <span class="sc">*</span> cntg)</span>
<span id="cb55-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb55-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>The second alternative is to define a new counterfactual border variable. We only show this equivalent case without computation.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb56-1" aria-hidden="true" tabindex="-1"></a>ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb56-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">intl_cfl =</span> <span class="dv">0</span>,</span>
<span id="cb56-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">tij_bln =</span> <span class="fu">exp</span>(fit_baseline_app1<span class="sc">$</span>coefficients[<span class="st">&quot;log_dist&quot;</span>] <span class="sc">*</span> log_dist <span class="sc">+</span></span>
<span id="cb56-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb56-5" aria-hidden="true" tabindex="-1"></a>                  fit_baseline_app1<span class="sc">$</span>coefficients[<span class="st">&quot;cntg&quot;</span>] <span class="sc">*</span> cntg <span class="sc">+</span></span>
<span id="cb56-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb56-6" aria-hidden="true" tabindex="-1"></a>                  fit_baseline_app1<span class="sc">$</span>coefficients[<span class="st">&quot;intl&quot;</span>] <span class="sc">*</span> intl_cfl)</span>
<span id="cb56-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb56-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="step-iii-solve-the-counterfactual-model" class="section level3 hasAnchor" number="3.1.4">
<h3><span class="header-section-number">3.1.4</span> Step III: Solve the counterfactual model<a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-iii-solve-the-counterfactual-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We need to fit a model similar to the model from step I, the constrained gravity model, where <span class="math inline">\(\pi_{j,t}\)</span> and <span class="math inline">\(\chi_{j,t}\)</span> are altered as in the equation</p>
<p><span class="math display">\[
\begin{align}
X_{ij,t} =&amp; \:\exp\left[\pi_{i,t}^{CFL} + \chi_{i,t}^{CFL} + \beta_1 \log(DIST)_{i,j} + \beta_2 CNTG_{i,j} + \beta_3 INTL_{i,j}\right] \times \varepsilon_{ij,t}.
\end{align}
\]</span></p>
<p>Box #1 from page 106 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span> estimates the constrained gravity model with the PPML estimator using an offset argument, which is straightforward in R.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb57-1" aria-hidden="true" tabindex="-1"></a>fit_counterfactual_app1 <span class="ot">&lt;-</span> <span class="fu">fepois</span>(</span>
<span id="cb57-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb57-2" aria-hidden="true" tabindex="-1"></a>  trade <span class="sc">~</span> <span class="dv">0</span> <span class="sc">|</span> exporter <span class="sc">+</span> importer,</span>
<span id="cb57-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ch2_application1,</span>
<span id="cb57-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">offset =</span> <span class="sc">~</span><span class="fu">log</span>(tij_cfl),</span>
<span id="cb57-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">glm.iter =</span> <span class="dv">500</span></span>
<span id="cb57-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb57-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>As in the previous chapter, we need to extract the fixed effects.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb58-1" aria-hidden="true" tabindex="-1"></a>ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb58-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">fe_exporter_cfl =</span> <span class="fu">fixef</span>(fit_counterfactual_app1)<span class="sc">$</span>exporter[exporter],</span>
<span id="cb58-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fe_importer_cfl =</span> <span class="fu">fixef</span>(fit_counterfactual_app1)<span class="sc">$</span>importer[importer]</span>
<span id="cb58-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb58-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Now we go for Box #2 from page 106 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span>, where the authors obtain the bilateral trade costs and multilateral resistances variables.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb59-1" aria-hidden="true" tabindex="-1"></a>ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb59-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># outward multilateral resistance (omr)</span></span>
<span id="cb59-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">omr_cfl =</span> y <span class="sc">*</span> (e_r <span class="sc">/</span> <span class="fu">exp</span>(fe_exporter_cfl)),</span>
<span id="cb59-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># inward multilateral resistance (imr)</span></span>
<span id="cb59-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb59-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">imr_cfl =</span> e <span class="sc">/</span> (<span class="fu">exp</span>(fe_importer_cfl) <span class="sc">*</span> e_r)</span>
<span id="cb59-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb59-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Box #2 also shows how to compute trade’s conditional general equilibrium effects, similar to what we did in step I.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb60-1" aria-hidden="true" tabindex="-1"></a>ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(tradehat_cfl = predict(fit_counterfactual_app1, ch2_application1, &quot;response&quot;)) %&gt;%</span></span>
<span id="cb60-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tradehat_cfl =</span> <span class="fu">predict</span>(fit_counterfactual_app1, ch2_application1)) <span class="sc">%&gt;%</span></span>
<span id="cb60-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(exporter) <span class="sc">%&gt;%</span></span>
<span id="cb60-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xi_cfl =</span> <span class="fu">sum</span>(tradehat_cfl <span class="sc">*</span> (exporter <span class="sc">!=</span> importer))) <span class="sc">%&gt;%</span></span>
<span id="cb60-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>Box #1 from page 107 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span> can be simplified with R code. To construct the iterative procedure to converge to full endowment general equilibrium effects, we start by creating the required columns and parameters so that we will deviate from the original approach.</p>
<p>We start computing the change in bilateral trade costs (changes in <span class="math inline">\(t_{ij}\)</span>) and trade deficit or surplus (<span class="math inline">\(phi\)</span>). The value for the elasticity of substitution, <span class="math inline">\(\sigma = 7\)</span>, used to set the convergence criteria is taken from the literature. There is an explanation in the original Stata code.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb61-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb61-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb61-3" aria-hidden="true" tabindex="-1"></a>ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb61-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb61-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_tij =</span> tij_cfl <span class="sc">/</span> tij_bln,</span>
<span id="cb61-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">phi =</span> <span class="fu">ifelse</span>(importer <span class="sc">==</span> exporter, e <span class="sc">/</span> y, <span class="dv">0</span>)</span>
<span id="cb61-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb61-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb61-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(exporter) <span class="sc">%&gt;%</span></span>
<span id="cb61-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">phi =</span> <span class="fu">max</span>(phi)) <span class="sc">%&gt;%</span></span>
<span id="cb61-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb61-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>We compute the change in prices for exporters (changes in <span class="math inline">\(p_i\)</span>) and importers (changes in <span class="math inline">\(p_j\)</span>).</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb62-1" aria-hidden="true" tabindex="-1"></a>ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(exporter) <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">change_p_i =</span> ((<span class="fu">exp</span>(fe_exporter_cfl) <span class="sc">/</span> e_r) <span class="sc">/</span> (<span class="fu">exp</span>(fe_exporter_bln) <span class="sc">/</span> e_r))<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span>(<span class="dv">1</span> <span class="sc">-</span> sigma))) <span class="sc">%&gt;%</span></span>
<span id="cb62-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(importer) <span class="sc">%&gt;%</span></span>
<span id="cb62-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb62-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_p_j =</span> <span class="fu">ifelse</span>(importer <span class="sc">==</span> exporter, change_p_i, <span class="dv">0</span>),</span>
<span id="cb62-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb62-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_p_j =</span> <span class="fu">max</span>(change_p_j)</span>
<span id="cb62-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb62-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb62-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>Next, we need to compute the counterfactual trade flows.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb63-1" aria-hidden="true" tabindex="-1"></a>ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trade_cfl =</span> tradehat_cfl <span class="sc">*</span> change_p_i <span class="sc">*</span> change_p_j)</span></code></pre></div>
<p>To conclude the steps from Box #1 we need a <code>while()</code> loop and iterate until convergence is reached. We need to duplicate some columns under new names for the loop operations because we will overwrite them using the iterative steps.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb64-1" aria-hidden="true" tabindex="-1"></a>ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb64-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">omr_cfl_0 =</span> omr_cfl,</span>
<span id="cb64-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb64-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">imr_cfl_0 =</span> imr_cfl,</span>
<span id="cb64-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_imr_full_0 =</span> <span class="dv">1</span>,</span>
<span id="cb64-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb64-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_omr_full_0 =</span> <span class="dv">1</span>,</span>
<span id="cb64-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_p_i_0 =</span> change_p_i,</span>
<span id="cb64-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb64-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_p_j_0 =</span> change_p_j,</span>
<span id="cb64-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb64-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fe_exporter_cfl_0 =</span> fe_exporter_cfl,</span>
<span id="cb64-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb64-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fe_importer_cfl_0 =</span> fe_importer_cfl,</span>
<span id="cb64-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb64-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">tradehat_0 =</span> tradehat_cfl,</span>
<span id="cb64-12"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb64-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">e_r_cfl_0 =</span> e_r</span>
<span id="cb64-13"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb64-13" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>We run the loop, which cannot be divided into smaller pieces because the step <span class="math inline">\(N\)</span> depends on the step <span class="math inline">\(N-1\)</span>. As in the previous application, the idea is for the stopping criteria in this iteration is that the model converges when prices stop changing.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set parameters</span></span>
<span id="cb65-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-2" aria-hidden="true" tabindex="-1"></a>max_dif <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb65-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-3" aria-hidden="true" tabindex="-1"></a>sd_dif <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb65-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-4" aria-hidden="true" tabindex="-1"></a>change_price_i_old <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb65-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-6" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb65-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(sd_dif <span class="sc">&gt;</span> <span class="fl">1e-5</span> <span class="sc">|</span> max_dif <span class="sc">&gt;</span> <span class="fl">1e-5</span>) {</span>
<span id="cb65-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-8" aria-hidden="true" tabindex="-1"></a>  ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb65-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">trade_1 =</span> tradehat_0 <span class="sc">*</span> change_p_i_0 <span class="sc">*</span> change_p_j_0 <span class="sc">/</span> (change_omr_full_0 <span class="sc">*</span> change_imr_full_0))</span>
<span id="cb65-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># repeat the counterfactual model</span></span>
<span id="cb65-12"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-12" aria-hidden="true" tabindex="-1"></a>  fit_counterfactual_app1_2 <span class="ot">&lt;-</span> <span class="fu">fepois</span>(</span>
<span id="cb65-13"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-13" aria-hidden="true" tabindex="-1"></a>    trade_1 <span class="sc">~</span> <span class="dv">0</span> <span class="sc">|</span> exporter <span class="sc">+</span> importer,</span>
<span id="cb65-14"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ch2_application1,</span>
<span id="cb65-15"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">offset =</span> <span class="sc">~</span><span class="fu">log</span>(tij_cfl),</span>
<span id="cb65-16"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">glm.iter =</span> <span class="dv">500</span></span>
<span id="cb65-17"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-18"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-19"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-19" aria-hidden="true" tabindex="-1"></a>  ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb65-20"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb65-21"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">fe_exporter_cfl_1 =</span> <span class="fu">fixef</span>(fit_counterfactual_app1_2)<span class="sc">$</span>exporter[exporter],</span>
<span id="cb65-22"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">fe_importer_cfl_1 =</span> <span class="fu">fixef</span>(fit_counterfactual_app1_2)<span class="sc">$</span>importer[importer]</span>
<span id="cb65-23"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-24"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-25"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the conditional general equilibrium effects of trade</span></span>
<span id="cb65-26"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-26" aria-hidden="true" tabindex="-1"></a>  ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb65-27"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">tradehat_1 =</span> <span class="fu">predict</span>(fit_counterfactual_app1_2, ch2_application1)) <span class="sc">%&gt;%</span></span>
<span id="cb65-28"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(exporter) <span class="sc">%&gt;%</span></span>
<span id="cb65-29"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">y_cfl_1 =</span> <span class="fu">sum</span>(tradehat_1)) <span class="sc">%&gt;%</span></span>
<span id="cb65-30"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb65-31"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-32"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">e_cfl_1 =</span> <span class="fu">ifelse</span>(importer <span class="sc">==</span> exporter, phi <span class="sc">*</span> y_cfl_1, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb65-33"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(importer) <span class="sc">%&gt;%</span></span>
<span id="cb65-34"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">e_cfl_1 =</span> <span class="fu">max</span>(e_cfl_1)) <span class="sc">%&gt;%</span></span>
<span id="cb65-35"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb65-36"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-37"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb65-38"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">e_r_cfl_1 =</span> <span class="fu">ifelse</span>(importer <span class="sc">==</span> <span class="st">&quot;0-DEU&quot;</span>, e_cfl_1, <span class="dv">0</span>),</span>
<span id="cb65-39"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">e_r_cfl_1 =</span> <span class="fu">max</span>(e_r_cfl_1)</span>
<span id="cb65-40"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-40" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-41"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-42"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the change in prices for exporters and importers</span></span>
<span id="cb65-43"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-43" aria-hidden="true" tabindex="-1"></a>  ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb65-44"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">change_p_i_1 =</span> ((<span class="fu">exp</span>(fe_exporter_cfl_1) <span class="sc">/</span> e_r_cfl_1) <span class="sc">/</span></span>
<span id="cb65-45"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-45" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">exp</span>(fe_exporter_cfl_0) <span class="sc">/</span> e_r_cfl_0))<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> sigma)))</span>
<span id="cb65-46"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-47"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the change in prices for exporters and importers</span></span>
<span id="cb65-48"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-48" aria-hidden="true" tabindex="-1"></a>  ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb65-49"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(importer) <span class="sc">%&gt;%</span></span>
<span id="cb65-50"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb65-51"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">change_p_j_1 =</span> <span class="fu">ifelse</span>(importer <span class="sc">==</span> exporter, change_p_i_1, <span class="dv">0</span>),</span>
<span id="cb65-52"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">change_p_j_1 =</span> <span class="fu">max</span>(change_p_j_1)</span>
<span id="cb65-53"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-53" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb65-54"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb65-55"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-56"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute both outward and inward multilateral resistance</span></span>
<span id="cb65-57"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-57" aria-hidden="true" tabindex="-1"></a>  ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb65-58"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb65-59"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">omr_cfl_1 =</span> (y_cfl_1 <span class="sc">*</span> e_r_cfl_1) <span class="sc">/</span> <span class="fu">exp</span>(fe_exporter_cfl_1),</span>
<span id="cb65-60"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-60" aria-hidden="true" tabindex="-1"></a>      <span class="at">imr_cfl_1 =</span> e_cfl_1 <span class="sc">/</span> (<span class="fu">exp</span>(fe_importer_cfl_1) <span class="sc">*</span> e_r_cfl_1)</span>
<span id="cb65-61"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-61" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-62"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-63"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># update the differences</span></span>
<span id="cb65-64"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-64" aria-hidden="true" tabindex="-1"></a>  max_dif <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">max</span>(ch2_application1<span class="sc">$</span>change_p_i_0 <span class="sc">-</span> change_price_i_old))</span>
<span id="cb65-65"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-65" aria-hidden="true" tabindex="-1"></a>  sd_dif <span class="ot">&lt;-</span> <span class="fu">sd</span>(ch2_application1<span class="sc">$</span>change_p_i_0 <span class="sc">-</span> change_price_i_old)</span>
<span id="cb65-66"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-66" aria-hidden="true" tabindex="-1"></a>  change_price_i_old <span class="ot">&lt;-</span> ch2_application1<span class="sc">$</span>change_p_i_0</span>
<span id="cb65-67"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-68"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute changes in outward and inward multilateral resistance</span></span>
<span id="cb65-69"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-69" aria-hidden="true" tabindex="-1"></a>  ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb65-70"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb65-71"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-71" aria-hidden="true" tabindex="-1"></a>      <span class="at">change_omr_full_1 =</span> omr_cfl_1 <span class="sc">/</span> omr_cfl_0,</span>
<span id="cb65-72"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-72" aria-hidden="true" tabindex="-1"></a>      <span class="at">change_imr_full_1 =</span> imr_cfl_1 <span class="sc">/</span> imr_cfl_0,</span>
<span id="cb65-73"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">omr_cfl_0 =</span> omr_cfl_1,</span>
<span id="cb65-74"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-74" aria-hidden="true" tabindex="-1"></a>      <span class="at">imr_cfl_0 =</span> imr_cfl_1,</span>
<span id="cb65-75"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-75" aria-hidden="true" tabindex="-1"></a>      <span class="at">change_omr_full_0 =</span> change_omr_full_1,</span>
<span id="cb65-76"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-76" aria-hidden="true" tabindex="-1"></a>      <span class="at">change_imr_full_0 =</span> change_imr_full_1,</span>
<span id="cb65-77"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-77" aria-hidden="true" tabindex="-1"></a>      <span class="at">change_p_i_0 =</span> change_p_i_1,</span>
<span id="cb65-78"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-78" aria-hidden="true" tabindex="-1"></a>      <span class="at">change_p_j_0 =</span> change_p_j_1,</span>
<span id="cb65-79"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-79" aria-hidden="true" tabindex="-1"></a>      <span class="at">fe_exporter_cfl_0 =</span> fe_exporter_cfl_1,</span>
<span id="cb65-80"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-80" aria-hidden="true" tabindex="-1"></a>      <span class="at">fe_importer_cfl_0 =</span> fe_importer_cfl_1,</span>
<span id="cb65-81"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">tradehat_0 =</span> tradehat_1,</span>
<span id="cb65-82"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-82" aria-hidden="true" tabindex="-1"></a>      <span class="at">e_r_cfl_0 =</span> e_r_cfl_1</span>
<span id="cb65-83"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-83" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb65-84"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(fe_exporter_cfl_1, fe_importer_cfl_1))</span>
<span id="cb65-85"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-86"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-86" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb65-87"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb65-87" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>In the previous step, we obtained a warning that we cannot eliminate by increasing GLM interations. The fitted model has truncated deviance for steps eight and twenty-two in the while loop. We tested with 20,000
GLM iterations for each step, resulting in a very similar message:</p>
<blockquote>
<p>Warning: Absence of convergence: Maximum number of iterations reached (20000). Final deviance: 3.725e-8.
Warning: Absence of convergence: Maximum number of iterations reached (20000). Final deviance: -4.47e-8.</p>
</blockquote>
<p>This is not a problem by itself, and we can disregard this. A very different
case would be estimating a model with high collinearity, resulting in
coefficients with undefined standard errors and an unreliable result.</p>
<p>Box #1 from page 108 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span> shows the steps to obtain different endowments, which can be divided into smaller pieces. We start computing the full endowment general equilibrium of factory-gate price (changes in <span class="math inline">\(p_i^{full}\)</span> and <span class="math inline">\(p_j^{full}\)</span>) and the full endowment general equilibrium of output (<span class="math inline">\(y^{full}\)</span>).</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb66-1" aria-hidden="true" tabindex="-1"></a>ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb66-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb66-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb66-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_p_i_full =</span> ((<span class="fu">exp</span>(fe_exporter_cfl_0) <span class="sc">/</span> e_r_cfl_0) <span class="sc">/</span></span>
<span id="cb66-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb66-4" aria-hidden="true" tabindex="-1"></a>                         (<span class="fu">exp</span>(fe_exporter_bln) <span class="sc">/</span> e_r))<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> sigma)),</span>
<span id="cb66-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb66-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_p_j_full =</span> change_p_i_full <span class="sc">*</span> (exporter <span class="sc">==</span> importer)</span>
<span id="cb66-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb66-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb66-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(importer) <span class="sc">%&gt;%</span></span>
<span id="cb66-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">change_p_j_full =</span> <span class="fu">max</span>(change_p_j_full)) <span class="sc">%&gt;%</span></span>
<span id="cb66-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y_full =</span> change_p_i_full <span class="sc">*</span> y)</span></code></pre></div>
<p>We compute the full endowment general equilibrium of aggregate expenditures (<span class="math inline">\(e^{full}\)</span> and <span class="math inline">\(e_r^{full}\)</span>).</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb67-1" aria-hidden="true" tabindex="-1"></a>ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">e_full =</span> change_p_j_full <span class="sc">*</span> e <span class="sc">*</span> (exporter <span class="sc">==</span> importer)) <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(importer) <span class="sc">%&gt;%</span></span>
<span id="cb67-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">e_full =</span> <span class="fu">max</span>(e_full, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb67-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb67-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb67-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb67-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">e_full_r =</span> e_full <span class="sc">*</span> (importer <span class="sc">==</span> <span class="st">&quot;0-DEU&quot;</span>),</span>
<span id="cb67-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb67-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">e_full_r =</span> <span class="fu">max</span>(e_full_r)</span>
<span id="cb67-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb67-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>With the aggregate expenditure, we proceed to obtain the full endowment general equilibrium of the outward multilateral resistance (<span class="math inline">\(OMR^{full}\)</span>) and inward multilateral resistance (<span class="math inline">\(IMR^{full}\)</span>).</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb68-1" aria-hidden="true" tabindex="-1"></a>ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb68-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb68-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb68-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">omr_full =</span> y_full <span class="sc">*</span> e_r_cfl_0 <span class="sc">/</span> <span class="fu">exp</span>(fe_exporter_cfl_0),</span>
<span id="cb68-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb68-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">imr_full =</span> e_full <span class="sc">/</span> (<span class="fu">exp</span>(fe_importer_cfl_0) <span class="sc">*</span> e_full_r)</span>
<span id="cb68-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb68-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Finally, we proceed to compute the full endowment general equilibrium of trade (<span class="math inline">\(\xi^{full}\)</span>).</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb69-1" aria-hidden="true" tabindex="-1"></a>ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x_full =</span> (y_full <span class="sc">*</span> e_full <span class="sc">*</span> tij_cfl) <span class="sc">/</span> (imr_full <span class="sc">*</span> omr_full)) <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(exporter) <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xi_full =</span> <span class="fu">sum</span>(x_full <span class="sc">*</span> (importer <span class="sc">!=</span> exporter))) <span class="sc">%&gt;%</span></span>
<span id="cb69-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
<div id="step-iv-collect-construct-and-report-indexes-of-interest" class="section level3 hasAnchor" number="3.1.5">
<h3><span class="header-section-number">3.1.5</span> Step IV: Collect, construct, and report indexes of interest<a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-iv-collect-construct-and-report-indexes-of-interest" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Box #1 from page 108 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span> consists of constructing the percentage change of the general equilibrium indexes. The steps are direct. We need to compute the change in full endowment general equilibrium factory-gate price on the export side (changes in <span class="math inline">\(p_i{full}\)</span>), the change in conditional and full general equilibrium outward multilateral resistances (changes in <span class="math inline">\(OMR^{CFL}\)</span> and <span class="math inline">\(OMR^{full}\)</span>), and the change in conditional and full general equilibrium international trade (changes in <span class="math inline">\(\xi^{CFL}\)</span> and <span class="math inline">\(\xi^{full}\)</span>).</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb70-1" aria-hidden="true" tabindex="-1"></a>ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb70-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb70-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb70-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_price_full =</span> (change_p_i_full <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb70-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_omr_cfl =</span> (omr_cfl<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> sigma)) <span class="sc">/</span> omr_bln<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> sigma)) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb70-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb70-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_omr_full =</span> (omr_full<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> sigma)) <span class="sc">/</span> omr_bln<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> sigma)) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb70-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb70-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_xi_cfl =</span> (xi_cfl <span class="sc">/</span> xi_bln  <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb70-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb70-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_xi_full =</span> (xi_full <span class="sc">/</span> xi_bln <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb70-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb70-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>We also need to do something very similar for the importers in order to be able to recreate figure 7 later.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb71-1" aria-hidden="true" tabindex="-1"></a>ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb71-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb71-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb71-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_imr_full =</span> <span class="sc">-</span>(imr_full<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> sigma)) <span class="sc">/</span> imr_bln<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> sigma)) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb71-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">rgdp =</span> ((y_full <span class="sc">/</span> imr_full<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> sigma))) <span class="sc">/</span> (y <span class="sc">/</span> imr_bln<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> sigma))) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb71-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb71-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="figures-replication" class="section level3 hasAnchor" number="3.1.6">
<h3><span class="header-section-number">3.1.6</span> Figures replication<a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#figures-replication" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>With all of the steps above, we are ready to create the plots from page 110. in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span>. Figure 6 removes the observations where both the importer and the exporter are different, and this can be seen in the original Stata code provided with the book.</p>
<p>We need to filter rows and to obtain <span class="math inline">\(\log(y)\)</span>.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb72-1" aria-hidden="true" tabindex="-1"></a>ch2_application1 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(exporter <span class="sc">==</span> importer) <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(exporter, importer, y, change_xi_cfl, change_xi_full, rgdp,</span>
<span id="cb72-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb72-4" aria-hidden="true" tabindex="-1"></a>         change_price_full, change_imr_full) <span class="sc">%&gt;%</span></span>
<span id="cb72-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_y =</span> <span class="fu">log</span>(y))</span></code></pre></div>
<p>In addition, the original code removes Hong Kong for visualization scale purposes.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-1" aria-hidden="true" tabindex="-1"></a>data_figure_6 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span> </span>
<span id="cb73-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(exporter <span class="sc">!=</span> <span class="st">&quot;HKG&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb73-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">x =</span> log_y, change_xi_cfl, change_xi_full) <span class="sc">%&gt;%</span> </span>
<span id="cb73-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">&quot;change&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;y&quot;</span>, <span class="sc">-</span>x) <span class="sc">%&gt;%</span> </span>
<span id="cb73-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb73-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">change =</span> <span class="fu">case_when</span>(</span>
<span id="cb73-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-7" aria-hidden="true" tabindex="-1"></a>      change <span class="sc">==</span> <span class="st">&quot;change_xi_cfl&quot;</span> <span class="sc">~</span> <span class="st">&quot;Conditional general equilibrium&quot;</span>,</span>
<span id="cb73-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-8" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Full endowment general equilibrium&quot;</span></span>
<span id="cb73-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb73-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-12"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_figure_6) <span class="sc">+</span></span>
<span id="cb73-13"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> change)) <span class="sc">+</span></span>
<span id="cb73-14"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb73-15"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Log value of output&quot;</span>,</span>
<span id="cb73-16"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Percent change of exports&quot;</span>,</span>
<span id="cb73-17"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Figure 6: Effects of abolishing international borders on exports&quot;</span>,</span>
<span id="cb73-18"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Source: Authors&#39; calculations&quot;</span>,</span>
<span id="cb73-19"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb73-20"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb73-21"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb73-22"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb73-23"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb73-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#b6b8dd&quot;</span>,<span class="st">&quot;#232958&quot;</span>))</span></code></pre></div>
<p><img src="tradepolicy_files/figure-html/ch2_app1_figures_2-1.png" width="672" /></p>
<p>To create Figure 7, we proceed in the same way as Figure 6.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-1" aria-hidden="true" tabindex="-1"></a>data_figure_7 <span class="ot">&lt;-</span> ch2_application1 <span class="sc">%&gt;%</span> </span>
<span id="cb74-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(exporter <span class="sc">!=</span> <span class="st">&quot;HKG&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb74-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">x =</span> log_y, change_imr_full, change_price_full, rgdp) <span class="sc">%&gt;%</span> </span>
<span id="cb74-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">&quot;change&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;y&quot;</span>, <span class="sc">-</span>x) <span class="sc">%&gt;%</span> </span>
<span id="cb74-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb74-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">change =</span> <span class="fu">case_when</span>(</span>
<span id="cb74-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-7" aria-hidden="true" tabindex="-1"></a>      change <span class="sc">==</span> <span class="st">&quot;change_imr_full&quot;</span> <span class="sc">~</span> <span class="st">&quot;-(inward multilateral resistances)&quot;</span>,</span>
<span id="cb74-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-8" aria-hidden="true" tabindex="-1"></a>      change <span class="sc">==</span> <span class="st">&quot;change_price_full&quot;</span> <span class="sc">~</span> <span class="st">&quot;Factory-gate price&quot;</span>,</span>
<span id="cb74-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Real GDP&quot;</span></span>
<span id="cb74-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb74-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb74-12"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-13"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_figure_7) <span class="sc">+</span></span>
<span id="cb74-14"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> change)) <span class="sc">+</span></span>
<span id="cb74-15"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb74-16"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Log value of output&quot;</span>,</span>
<span id="cb74-17"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Percent changes&quot;</span>,</span>
<span id="cb74-18"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Figure 7: Effects of abolishing international borders on real GDP&quot;</span>,</span>
<span id="cb74-19"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Note: The inward multilateral resistances have been reformulated by multiplying their value by minus one.</span><span class="sc">\n</span><span class="st">Source: Authors&#39; calculations&quot;</span>,</span>
<span id="cb74-20"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb74-21"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb74-22"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb74-23"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb74-24"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb74-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#3bade3&quot;</span>, <span class="st">&quot;#b6b8dd&quot;</span>, <span class="st">&quot;#232958&quot;</span>))</span></code></pre></div>
<p><img src="tradepolicy_files/figure-html/ch2_app1_figures_3-1.png" width="672" /></p>
</div>
</div>
<div id="impact-of-regional-trade-agreements" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Impact of regional trade agreements<a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#impact-of-regional-trade-agreements" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="initial-data-1" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Initial data<a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#initial-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As in the previous application, we shall proceed by alternating both data transforming and regressions. To replicate the results from box #1 on page 112 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span>, we need to convert “DEU” in both exporter and importer columns to “0-DEU”, as in the previous section.</p>
<p>However, in this case, we shall keep the panel dimension of the dataset to identify the effects of RTAs and comprehensively capture the impact of all time-invariant trade costs with the use of pair fixed effects.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-1" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> agtpa_applications <span class="sc">%&gt;%</span></span>
<span id="cb75-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(exporter, importer, pair_id, year, trade, dist, cntg, lang, clny, rta) <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="dv">1986</span>, <span class="dv">2006</span>, <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb75-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb75-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_dist =</span> <span class="fu">log</span>(dist),</span>
<span id="cb75-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">intl =</span> <span class="fu">ifelse</span>(exporter <span class="sc">!=</span> importer, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb75-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">exporter =</span> <span class="fu">ifelse</span>(exporter <span class="sc">==</span> <span class="st">&quot;DEU&quot;</span>, <span class="st">&quot;0-DEU&quot;</span>, exporter),</span>
<span id="cb75-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">importer =</span> <span class="fu">ifelse</span>(importer <span class="sc">==</span> <span class="st">&quot;DEU&quot;</span>, <span class="st">&quot;0-DEU&quot;</span>, importer)</span>
<span id="cb75-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb75-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create Yit</span></span>
<span id="cb75-12"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(exporter, year) <span class="sc">%&gt;%</span></span>
<span id="cb75-13"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">sum</span>(trade)) <span class="sc">%&gt;%</span></span>
<span id="cb75-14"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-15"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create Eit</span></span>
<span id="cb75-16"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(importer, year) <span class="sc">%&gt;%</span></span>
<span id="cb75-17"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">e =</span> <span class="fu">sum</span>(trade)) <span class="sc">%&gt;%</span></span>
<span id="cb75-18"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-19"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create Er</span></span>
<span id="cb75-20"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb75-21"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">e_r =</span> <span class="fu">max</span>(<span class="fu">ifelse</span>(importer <span class="sc">==</span> <span class="st">&quot;0-DEU&quot;</span>, e, <span class="cn">NA</span>), <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-22"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb75-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(importer)</span></code></pre></div>
<p>Because of the panel dimension, we proceed as we did in the previous chapter by creating columns to combine exporter/importer and year alongside a pairing variable for the internal dyads for the fixed effects.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb76-1" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb76-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp_year =</span> <span class="fu">paste0</span>(exporter, year),</span>
<span id="cb76-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">imp_year =</span> <span class="fu">paste0</span>(importer, year),</span>
<span id="cb76-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb76-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">pair_id_2 =</span> <span class="fu">ifelse</span>(exporter <span class="sc">==</span> importer, <span class="st">&quot;0-intra&quot;</span>, pair_id)</span>
<span id="cb76-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb76-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>In addition, we need to compute the trade sum to filter the cases where the sum by dyad is zero.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb77-1" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(pair_id) <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sum_trade =</span> <span class="fu">sum</span>(trade)) <span class="sc">%&gt;%</span></span>
<span id="cb77-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
<div id="step-1-solve-the-baseline-gravity-model" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Step 1: Solve the baseline gravity model<a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-1-solve-the-baseline-gravity-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="stage-1-obtain-the-estimates-of-pair-fixed-effects-and-the-effects-of-rtas" class="section level4 hasAnchor" number="3.2.2.1">
<h4><span class="header-section-number">3.2.2.1</span> Stage 1: Obtain the estimates of pair fixed effects and the effects of RTAs<a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#stage-1-obtain-the-estimates-of-pair-fixed-effects-and-the-effects-of-rtas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>With the steps done before, it is straightforward to obtain the PPML regression shown in box #1 from page 112 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span>.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb78-1" aria-hidden="true" tabindex="-1"></a>fit_baseline_app2 <span class="ot">&lt;-</span> <span class="fu">fepois</span>(</span>
<span id="cb78-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb78-2" aria-hidden="true" tabindex="-1"></a>  trade <span class="sc">~</span> rta <span class="sc">|</span> exp_year <span class="sc">+</span> imp_year <span class="sc">+</span> pair_id_2,</span>
<span id="cb78-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">filter</span>(ch2_application2, sum_trade <span class="sc">&gt;</span> <span class="dv">0</span>),</span>
<span id="cb78-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">glm.iter =</span> <span class="dv">500</span></span>
<span id="cb78-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb78-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>We can construct the variables for exporter-time, importer-time, and internal dyads with the estimated fixed effects from the model.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb79-1" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb79-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb79-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb79-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">fe_exporter_bln =</span> <span class="fu">fixef</span>(fit_baseline_app2)<span class="sc">$</span>exp_year[exp_year],</span>
<span id="cb79-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb79-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fe_importer_bln =</span> <span class="fu">fixef</span>(fit_baseline_app2)<span class="sc">$</span>imp_year[imp_year],</span>
<span id="cb79-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb79-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fe_pair_id_2_bln =</span> <span class="fu">fixef</span>(fit_baseline_app2)<span class="sc">$</span>pair_id_2[pair_id_2]</span>
<span id="cb79-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb79-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="stage-2-regress-the-estimates-of-pair-fixed-effects-on-gravity-variables-and-country-fixed-effects" class="section level4 hasAnchor" number="3.2.2.2">
<h4><span class="header-section-number">3.2.2.2</span> Stage 2: Regress the estimates of pair fixed effects on gravity variables and country fixed effects<a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#stage-2-regress-the-estimates-of-pair-fixed-effects-on-gravity-variables-and-country-fixed-effects" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Box #1 from page 113 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span> can be divided into smaller chunks.
We start by filtering to keep the observation from 1994, and then we compute the trade costs (<span class="math inline">\(\bar{t}_{ij}\)</span> and <span class="math inline">\(t_{ij}^{BLN}\)</span>) from the internal dyads fixed effects and the estimated RTA coefficient.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb80-1" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb80-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">tij_bar =</span> <span class="fu">exp</span>(fe_pair_id_2_bln),</span>
<span id="cb80-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb80-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">tij_bln =</span> <span class="fu">exp</span>(fe_pair_id_2_bln <span class="sc">+</span> fit_baseline_app2<span class="sc">$</span>coefficients[<span class="st">&quot;rta&quot;</span>] <span class="sc">*</span> rta)</span>
<span id="cb80-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb80-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>We need to create a table for the year 1994, which we will use to predict the trade costs for the observations with zero trade flows. The reason to create a sub-table, instead of filtering observations in the regression function, is that it eases posterior work to predict the costs.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb81-1" aria-hidden="true" tabindex="-1"></a>ch2_application2_1994 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1994</span>, exporter <span class="sc">!=</span> importer)</span></code></pre></div>
<p>Now, unlike the book, which duplicates <span class="math inline">\(\overline{t_{ij}}\)</span> by creating <span class="math inline">\(t_{ij}\)</span>, we can fit a regression to estimate the costs. This is something that emerges
from the small differences between expressing an idea in Stata or R.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb82-1" aria-hidden="true" tabindex="-1"></a>fit_costs_app2 <span class="ot">&lt;-</span> <span class="fu">fepois</span>(</span>
<span id="cb82-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb82-2" aria-hidden="true" tabindex="-1"></a>  tij_bar <span class="sc">~</span> log_dist <span class="sc">+</span> cntg <span class="sc">+</span> lang <span class="sc">+</span> clny <span class="sc">|</span> exporter <span class="sc">+</span> importer,</span>
<span id="cb82-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ch2_application2_1994,</span>
<span id="cb82-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">glm.iter =</span> <span class="dv">500</span></span>
<span id="cb82-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb82-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>With the regression, we add the fitted values to the sub-table.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb83-1" aria-hidden="true" tabindex="-1"></a>ch2_application2_1994 <span class="ot">&lt;-</span> ch2_application2_1994 <span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tij_no_rta =</span> <span class="fu">predict</span>(fit_costs_app2, ch2_application2_1994)) <span class="sc">%&gt;%</span></span>
<span id="cb83-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(exporter, importer, tij_no_rta)</span></code></pre></div>
<p>The final step is to keep the observations for the year 1994 in the original table and replace the missing costs with the predicted values.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb84-1" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1994</span>) <span class="sc">%&gt;%</span></span>
<span id="cb84-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ch2_application2_1994, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;exporter&quot;</span>, <span class="st">&quot;importer&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb84-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb84-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb84-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">tij_bar =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(tij_bar), tij_no_rta, tij_bar),</span>
<span id="cb84-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">tij_bln =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(tij_bln), tij_bar <span class="sc">*</span> <span class="fu">exp</span>(fit_baseline_app2<span class="sc">$</span>coefficients[<span class="st">&quot;rta&quot;</span>] <span class="sc">*</span> rta), tij_bln)</span>
<span id="cb84-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb84-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb84-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>tij_no_rta)</span></code></pre></div>
<p>Box #2 from page 113 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span> is easier to replicate. The first part of completing Box #2 involves solving the constrained baseline gravity model.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb85-1" aria-hidden="true" tabindex="-1"></a>fit_constrained_app2 <span class="ot">&lt;-</span> <span class="fu">fepois</span>(</span>
<span id="cb85-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb85-2" aria-hidden="true" tabindex="-1"></a>  trade <span class="sc">~</span> <span class="dv">0</span> <span class="sc">|</span> exporter <span class="sc">+</span> importer,</span>
<span id="cb85-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ch2_application2,</span>
<span id="cb85-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">offset =</span> <span class="sc">~</span><span class="fu">log</span>(tij_bln),</span>
<span id="cb85-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">glm.iter =</span> <span class="dv">500</span></span>
<span id="cb85-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb85-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>With the fitted model, we can add the prediction and the <span class="math inline">\(\xi^{BLN}\)</span> column.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb86-1" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb86-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tradehat_bln =</span> <span class="fu">predict</span>(fit_constrained_app2, ch2_application2)) <span class="sc">%&gt;%</span></span>
<span id="cb86-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(exporter) <span class="sc">%&gt;%</span></span>
<span id="cb86-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xi_bln =</span> <span class="fu">sum</span>(tradehat_bln <span class="sc">*</span> (exporter <span class="sc">!=</span> importer))) <span class="sc">%&gt;%</span></span>
<span id="cb86-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>The book specifies that all other baseline indexes of interest can be obtained by applying the same procedure described in the previous application. Here we will obtain the multilateral resistances terms (<span class="math inline">\(OMR^{BLN}\)</span> and <span class="math inline">\(IMR^{BLN}\)</span>) by adding the fixed effects from the constrained model to the data.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb87-1" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb87-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb87-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb87-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">fe_exporter_cns =</span> <span class="fu">fixef</span>(fit_constrained_app2)<span class="sc">$</span>exporter[exporter],</span>
<span id="cb87-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb87-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fe_importer_cns =</span> <span class="fu">fixef</span>(fit_constrained_app2)<span class="sc">$</span>importer[importer]</span>
<span id="cb87-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb87-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb87-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb87-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb87-7" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb87-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb87-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb87-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb87-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">omr_bln =</span> y <span class="sc">*</span> e_r<span class="sc">/</span> <span class="fu">exp</span>(fe_exporter_cns),</span>
<span id="cb87-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb87-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">imr_bln =</span> e <span class="sc">/</span> (<span class="fu">exp</span>(fe_importer_cns) <span class="sc">*</span> e_r)</span>
<span id="cb87-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb87-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
</div>
<div id="step-ii-define-a-counterfactual-scenario-1" class="section level3 hasAnchor" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Step II: Define a counterfactual scenario<a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-ii-define-a-counterfactual-scenario-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Box #1 from page 114 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span> is direct and consists in replacing the RTA values by zero if the pairs of countries are NAFTA members.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb88-1" aria-hidden="true" tabindex="-1"></a>nafta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;MEX&quot;</span>, <span class="st">&quot;USA&quot;</span>, <span class="st">&quot;CAN&quot;</span>)</span>
<span id="cb88-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb88-3" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb88-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb88-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb88-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">rta_no_nafta =</span> <span class="fu">ifelse</span>(exporter <span class="sc">%in%</span> nafta <span class="sc">&amp;</span> importer <span class="sc">%in%</span> nafta, <span class="dv">0</span>, rta),</span>
<span id="cb88-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb88-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">tij_cfl =</span> tij_bar <span class="sc">*</span> <span class="fu">exp</span>(fit_baseline_app2<span class="sc">$</span>coefficients[<span class="st">&quot;rta&quot;</span>] <span class="sc">*</span> rta_no_nafta)</span>
<span id="cb88-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb88-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="step-iii-solve-the-counterfactual-model-1" class="section level3 hasAnchor" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Step III: Solve the counterfactual model<a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-iii-solve-the-counterfactual-model-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The same procedure from the previous section applies to obtain the conditional general equilibrium effects and then compute the full endowment general equilibrium effects. We start by fitting a counterfactual model.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb89-1" aria-hidden="true" tabindex="-1"></a>fit_counterfactual_app2 <span class="ot">&lt;-</span> <span class="fu">fepois</span>(</span>
<span id="cb89-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb89-2" aria-hidden="true" tabindex="-1"></a>  trade <span class="sc">~</span> <span class="dv">0</span> <span class="sc">|</span> exporter <span class="sc">+</span> importer,</span>
<span id="cb89-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ch2_application2,</span>
<span id="cb89-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">offset =</span> <span class="sc">~</span><span class="fu">log</span>(tij_cfl),</span>
<span id="cb89-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb89-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">glm.iter =</span> <span class="dv">500</span></span>
<span id="cb89-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb89-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>With the fitted model we add the fixed effects.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb90-1" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb90-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb90-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb90-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">fe_exporter_cfl =</span> <span class="fu">fixef</span>(fit_counterfactual_app2)<span class="sc">$</span>exporter[exporter],</span>
<span id="cb90-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb90-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fe_importer_cfl =</span> <span class="fu">fixef</span>(fit_counterfactual_app2)<span class="sc">$</span>importer[importer]</span>
<span id="cb90-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb90-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>As we did in stage 2, we compute the multilateral resistance terms.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb91-1" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb91-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb91-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb91-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">omr_cfl =</span> y <span class="sc">*</span> e_r <span class="sc">/</span> <span class="fu">exp</span>(fe_exporter_cfl),</span>
<span id="cb91-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb91-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">imr_cfl =</span> e <span class="sc">/</span> (<span class="fu">exp</span>(fe_importer_cfl) <span class="sc">*</span> e_r)</span>
<span id="cb91-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb91-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Up to this point, we are ready to compute the conditional general equilibrium effects of trade.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb92-1" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tradehat_cfl =</span> <span class="fu">predict</span>(fit_counterfactual_app2, ch2_application2)) <span class="sc">%&gt;%</span></span>
<span id="cb92-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(exporter) <span class="sc">%&gt;%</span></span>
<span id="cb92-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xi_cfl =</span> <span class="fu">sum</span>(tradehat_cfl <span class="sc">*</span> (exporter <span class="sc">!=</span> importer))) <span class="sc">%&gt;%</span></span>
<span id="cb92-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>Now we are going to compute the full endowment general equilibrium effects. We start by repeating the steps to obtain changes in <span class="math inline">\(t_{ij}\)</span> <span class="math inline">\(\phi\)</span> from the last section. As the notes in the original Stata code say, the criteria of convergence (<span class="math inline">\(\sigma = 7\)</span>) was taken from the literature.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb93-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb93-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb93-3" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb93-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb93-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb93-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_tij =</span> tij_cfl <span class="sc">/</span> tij_bln,</span>
<span id="cb93-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb93-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">phi =</span> <span class="fu">ifelse</span>(importer <span class="sc">==</span> exporter, e <span class="sc">/</span> y, <span class="dv">0</span>)</span>
<span id="cb93-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb93-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb93-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb93-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(exporter) <span class="sc">%&gt;%</span></span>
<span id="cb93-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb93-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">phi =</span> <span class="fu">max</span>(phi)) <span class="sc">%&gt;%</span></span>
<span id="cb93-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb93-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>Now we compute changes in <span class="math inline">\(p_i\)</span>, <span class="math inline">\(p_j\)</span> and <span class="math inline">\(trade^{CFL}\)</span>, which is just a repetition of the previous steps with some adaptation.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb94-1" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb94-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(exporter) <span class="sc">%&gt;%</span></span>
<span id="cb94-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">change_p_i =</span> ((<span class="fu">exp</span>(fe_exporter_cfl) <span class="sc">/</span> e_r) <span class="sc">/</span> (<span class="fu">exp</span>(fe_exporter_cns) <span class="sc">/</span> e_r))<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span>(<span class="dv">1</span> <span class="sc">-</span> sigma))) <span class="sc">%&gt;%</span></span>
<span id="cb94-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb94-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb94-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(importer) <span class="sc">%&gt;%</span></span>
<span id="cb94-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb94-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb94-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb94-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_p_j =</span> <span class="fu">ifelse</span>(importer <span class="sc">==</span> exporter, change_p_i, <span class="dv">0</span>),</span>
<span id="cb94-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb94-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_p_j =</span> <span class="fu">max</span>(change_p_j)</span>
<span id="cb94-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb94-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb94-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb94-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb94-12"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb94-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-13"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb94-13" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb94-14"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb94-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trade_cfl =</span> tradehat_cfl <span class="sc">*</span> change_p_i <span class="sc">*</span> change_p_j)</span></code></pre></div>
<p>Then we need a <code>while()</code> loop, but before, we need to duplicate some columns under new names for the loop operations.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb95-1" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb95-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb95-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb95-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">omr_cfl_0 =</span> omr_cfl,</span>
<span id="cb95-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb95-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">imr_cfl_0 =</span> imr_cfl,</span>
<span id="cb95-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb95-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_imr_full_0 =</span> <span class="dv">1</span>,</span>
<span id="cb95-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb95-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_omr_full_0 =</span> <span class="dv">1</span>,</span>
<span id="cb95-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb95-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_p_i_0 =</span> change_p_i,</span>
<span id="cb95-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb95-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_p_j_0 =</span> change_p_j,</span>
<span id="cb95-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb95-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fe_exporter_cfl_0 =</span> fe_exporter_cfl,</span>
<span id="cb95-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb95-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fe_importer_cfl_0 =</span> fe_importer_cfl,</span>
<span id="cb95-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb95-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">tradehat_0 =</span> tradehat_cfl,</span>
<span id="cb95-12"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb95-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">e_r_cfl_0 =</span> e_r</span>
<span id="cb95-13"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb95-13" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Furthermore, now we run the loop, where the step <span class="math inline">\(N\)</span> depends on the step <span class="math inline">\(N-1\)</span> as in the previous section.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set parameters</span></span>
<span id="cb96-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-2" aria-hidden="true" tabindex="-1"></a>max_dif <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb96-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-3" aria-hidden="true" tabindex="-1"></a>sd_dif <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb96-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-4" aria-hidden="true" tabindex="-1"></a>change_price_i_old <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb96-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-6" aria-hidden="true" tabindex="-1"></a>i2 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb96-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-7" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(sd_dif <span class="sc">&gt;</span> <span class="fl">1e-3</span> <span class="sc">|</span> max_dif <span class="sc">&gt;</span> <span class="fl">1e-3</span>) {</span>
<span id="cb96-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-8" aria-hidden="true" tabindex="-1"></a>  ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb96-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">trade_1 =</span> tradehat_0 <span class="sc">*</span> change_p_i_0 <span class="sc">*</span> change_p_j_0 <span class="sc">/</span> (change_omr_full_0 <span class="sc">*</span> change_imr_full_0))</span>
<span id="cb96-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># repeat the counterfactual model</span></span>
<span id="cb96-12"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-12" aria-hidden="true" tabindex="-1"></a>  fit_counterfactual_app2_2 <span class="ot">&lt;-</span> <span class="fu">fepois</span>(</span>
<span id="cb96-13"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-13" aria-hidden="true" tabindex="-1"></a>    trade_1 <span class="sc">~</span> <span class="dv">0</span> <span class="sc">|</span> exporter <span class="sc">+</span> importer,</span>
<span id="cb96-14"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ch2_application2,</span>
<span id="cb96-15"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">offset =</span> <span class="sc">~</span><span class="fu">log</span>(tij_cfl),</span>
<span id="cb96-16"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">glm.iter =</span> <span class="dv">500</span></span>
<span id="cb96-17"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb96-18"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-19"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-19" aria-hidden="true" tabindex="-1"></a>  ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb96-20"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb96-21"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">fe_exporter_cfl =</span> <span class="fu">fixef</span>(fit_counterfactual_app2_2)<span class="sc">$</span>exporter[exporter],</span>
<span id="cb96-22"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">fe_importer_cfl =</span> <span class="fu">fixef</span>(fit_counterfactual_app2_2)<span class="sc">$</span>importer[importer]</span>
<span id="cb96-23"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb96-24"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-25"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the conditional general equilibrium effects of trade</span></span>
<span id="cb96-26"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-26" aria-hidden="true" tabindex="-1"></a>  ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb96-27"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">tradehat_1 =</span> <span class="fu">predict</span>(fit_counterfactual_app2_2, ch2_application2)) <span class="sc">%&gt;%</span></span>
<span id="cb96-28"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(exporter) <span class="sc">%&gt;%</span></span>
<span id="cb96-29"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">y_cfl_1 =</span> <span class="fu">sum</span>(tradehat_1)) <span class="sc">%&gt;%</span></span>
<span id="cb96-30"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb96-31"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-32"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">e_cfl_1 =</span> <span class="fu">ifelse</span>(importer <span class="sc">==</span> exporter, phi <span class="sc">*</span> y_cfl_1, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb96-33"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(importer) <span class="sc">%&gt;%</span></span>
<span id="cb96-34"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">e_cfl_1 =</span> <span class="fu">max</span>(e_cfl_1)) <span class="sc">%&gt;%</span></span>
<span id="cb96-35"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb96-36"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-37"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb96-38"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">e_r_cfl_1 =</span> <span class="fu">ifelse</span>(importer <span class="sc">==</span> <span class="st">&quot;0-DEU&quot;</span>, e_cfl_1, <span class="dv">0</span>),</span>
<span id="cb96-39"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">e_r_cfl_1 =</span> <span class="fu">max</span>(e_r_cfl_1)</span>
<span id="cb96-40"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-40" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb96-41"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-42"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the change in prices for exporters and importers</span></span>
<span id="cb96-43"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-43" aria-hidden="true" tabindex="-1"></a>  ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb96-44"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">change_p_i_1 =</span> ((<span class="fu">exp</span>(fe_exporter_cfl) <span class="sc">/</span> e_r_cfl_1) <span class="sc">/</span></span>
<span id="cb96-45"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-45" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">exp</span>(fe_exporter_cfl_0) <span class="sc">/</span> e_r_cfl_0))<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> sigma)))</span>
<span id="cb96-46"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-47"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the change in prices for exporters and importers</span></span>
<span id="cb96-48"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-48" aria-hidden="true" tabindex="-1"></a>  ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb96-49"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(importer) <span class="sc">%&gt;%</span></span>
<span id="cb96-50"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb96-51"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">change_p_j_1 =</span> <span class="fu">ifelse</span>(importer <span class="sc">==</span> exporter, change_p_i_1, <span class="dv">0</span>),</span>
<span id="cb96-52"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">change_p_j_1 =</span> <span class="fu">max</span>(change_p_j_1)</span>
<span id="cb96-53"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-53" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb96-54"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb96-55"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-56"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute both outward and inward multilateral resistance</span></span>
<span id="cb96-57"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-57" aria-hidden="true" tabindex="-1"></a>  ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb96-58"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb96-59"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">omr_cfl_1 =</span> (y_cfl_1 <span class="sc">*</span> e_r_cfl_1) <span class="sc">/</span> <span class="fu">exp</span>(fe_exporter_cfl),</span>
<span id="cb96-60"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-60" aria-hidden="true" tabindex="-1"></a>      <span class="at">imr_cfl_1 =</span> e_cfl_1 <span class="sc">/</span> (<span class="fu">exp</span>(fe_importer_cfl) <span class="sc">*</span> e_r_cfl_1)</span>
<span id="cb96-61"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-61" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb96-62"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-63"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># update the differences</span></span>
<span id="cb96-64"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-64" aria-hidden="true" tabindex="-1"></a>  max_dif <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">max</span>(ch2_application2<span class="sc">$</span>change_p_i_0 <span class="sc">-</span> change_price_i_old))</span>
<span id="cb96-65"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-65" aria-hidden="true" tabindex="-1"></a>  sd_dif <span class="ot">&lt;-</span> <span class="fu">sd</span>(ch2_application2<span class="sc">$</span>change_p_i_0 <span class="sc">-</span> change_price_i_old)</span>
<span id="cb96-66"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-66" aria-hidden="true" tabindex="-1"></a>  change_price_i_old <span class="ot">&lt;-</span> ch2_application2<span class="sc">$</span>change_p_i_0</span>
<span id="cb96-67"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-68"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute changes in outward and inward multilateral resistance</span></span>
<span id="cb96-69"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-69" aria-hidden="true" tabindex="-1"></a>  ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb96-70"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb96-71"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-71" aria-hidden="true" tabindex="-1"></a>      <span class="at">change_omr_full_1 =</span> omr_cfl_1 <span class="sc">/</span> omr_cfl_0,</span>
<span id="cb96-72"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-72" aria-hidden="true" tabindex="-1"></a>      <span class="at">change_imr_full_1 =</span> imr_cfl_1 <span class="sc">/</span> imr_cfl_0,</span>
<span id="cb96-73"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">omr_cfl_0 =</span> omr_cfl_1,</span>
<span id="cb96-74"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-74" aria-hidden="true" tabindex="-1"></a>      <span class="at">imr_cfl_0 =</span> imr_cfl_1,</span>
<span id="cb96-75"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-75" aria-hidden="true" tabindex="-1"></a>      <span class="at">change_omr_full_0 =</span> change_omr_full_1,</span>
<span id="cb96-76"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-76" aria-hidden="true" tabindex="-1"></a>      <span class="at">change_imr_full_0 =</span> change_imr_full_1,</span>
<span id="cb96-77"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-77" aria-hidden="true" tabindex="-1"></a>      <span class="at">change_p_i_0 =</span> change_p_i_1,</span>
<span id="cb96-78"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-78" aria-hidden="true" tabindex="-1"></a>      <span class="at">change_p_j_0 =</span> change_p_j_1,</span>
<span id="cb96-79"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-79" aria-hidden="true" tabindex="-1"></a>      <span class="at">fe_exporter_cfl_0 =</span> fe_exporter_cfl,</span>
<span id="cb96-80"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-80" aria-hidden="true" tabindex="-1"></a>      <span class="at">fe_importer_cfl_0 =</span> fe_importer_cfl,</span>
<span id="cb96-81"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">tradehat_0 =</span> tradehat_1,</span>
<span id="cb96-82"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-82" aria-hidden="true" tabindex="-1"></a>      <span class="at">e_r_cfl_0 =</span> e_r_cfl_1</span>
<span id="cb96-83"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-83" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb96-84"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>fe_exporter_cfl, <span class="sc">-</span>fe_importer_cfl)</span>
<span id="cb96-85"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-86"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-86" aria-hidden="true" tabindex="-1"></a>  i2 <span class="ot">&lt;-</span> i2 <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb96-87"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb96-87" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The last loop allows us to obtain changes in <span class="math inline">\(p_i^{full}\)</span>, <span class="math inline">\(p_j^{full}\)</span> and <span class="math inline">\(y^{full}\)</span>.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb97-1" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb97-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb97-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb97-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_p_i_full =</span> ((<span class="fu">exp</span>(fe_exporter_cfl_0) <span class="sc">/</span> e_r_cfl_0) <span class="sc">/</span></span>
<span id="cb97-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb97-4" aria-hidden="true" tabindex="-1"></a>                         (<span class="fu">exp</span>(fe_exporter_cns) <span class="sc">/</span> e_r))<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> sigma)),</span>
<span id="cb97-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb97-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_p_j_full =</span> change_p_i_full <span class="sc">*</span> (exporter <span class="sc">==</span> importer)</span>
<span id="cb97-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb97-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb97-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb97-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(importer) <span class="sc">%&gt;%</span></span>
<span id="cb97-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb97-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">change_p_j_full =</span> <span class="fu">max</span>(change_p_j_full)) <span class="sc">%&gt;%</span></span>
<span id="cb97-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb97-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb97-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb97-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y_full =</span> change_p_i_full <span class="sc">*</span> y)</span></code></pre></div>
<p>Now we compute $e^{full} and <span class="math inline">\(e_r^{full}\)</span>.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb98-1" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb98-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">e_full =</span> change_p_j_full <span class="sc">*</span> e <span class="sc">*</span> (exporter <span class="sc">==</span> importer)) <span class="sc">%&gt;%</span></span>
<span id="cb98-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(importer) <span class="sc">%&gt;%</span></span>
<span id="cb98-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">e_full =</span> <span class="fu">max</span>(e_full, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb98-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb98-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb98-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb98-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb98-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">e_full_r =</span> e_full <span class="sc">*</span> (importer <span class="sc">==</span> <span class="st">&quot;0-DEU&quot;</span>),</span>
<span id="cb98-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb98-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">e_full_r =</span> <span class="fu">max</span>(e_full_r)</span>
<span id="cb98-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb98-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>We also need <code>omr_full</code> and <code>imr_full</code>. This part of the code needs <em>attention</em> because the IMR full term is computed in a different way compared to the previous section. Please see the script <em>RTAsEffects.do</em>.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb99-1" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb99-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb99-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb99-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">omr_full =</span> y_full <span class="sc">*</span> e_r_cfl_0 <span class="sc">/</span> <span class="fu">exp</span>(fe_exporter_cfl_0),</span>
<span id="cb99-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb99-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">imr_full =</span> e_cfl_1 <span class="sc">/</span> (<span class="fu">exp</span>(fe_importer_cfl_0) <span class="sc">*</span> e_r_cfl_0)</span>
<span id="cb99-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb99-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>To complete this step, we compute <span class="math inline">\(\xi^{full}\)</span>.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb100-1" aria-hidden="true" tabindex="-1"></a>ch2_application2 <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb100-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x_full =</span> (y_full <span class="sc">*</span> e_full <span class="sc">*</span> tij_cfl) <span class="sc">/</span> (imr_full <span class="sc">*</span> omr_full)) <span class="sc">%&gt;%</span></span>
<span id="cb100-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(exporter) <span class="sc">%&gt;%</span></span>
<span id="cb100-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xi_full =</span> <span class="fu">sum</span>(x_full <span class="sc">*</span> (importer <span class="sc">!=</span> exporter))) <span class="sc">%&gt;%</span></span>
<span id="cb100-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
<div id="step-iv-collect-construct-and-report-indexes-of-interest-1" class="section level3 hasAnchor" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> Step IV: Collect, construct, and report indexes of interest<a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-iv-collect-construct-and-report-indexes-of-interest-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This step aims to reproduce the table from page 116 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span>.</p>
<p>To ease the task of creating the table from the book, we divide between exporter and importer indexes.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-1" aria-hidden="true" tabindex="-1"></a>exporter_indexes <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb101-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb101-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-3" aria-hidden="true" tabindex="-1"></a>    exporter, <span class="fu">starts_with</span>(<span class="st">&quot;omr_&quot;</span>), change_p_i_full,</span>
<span id="cb101-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">starts_with</span>(<span class="st">&quot;xi_&quot;</span>), y, y_full</span>
<span id="cb101-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb101-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">exporter =</span> <span class="fu">ifelse</span>(exporter <span class="sc">==</span> <span class="st">&quot;0-DEU&quot;</span>, <span class="st">&quot;DEU&quot;</span>, exporter)) <span class="sc">%&gt;%</span></span>
<span id="cb101-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(exporter) <span class="sc">%&gt;%</span></span>
<span id="cb101-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb101-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_p_i_full =</span> (<span class="dv">1</span> <span class="sc">-</span> change_p_i_full) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb101-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_omr_cfl =</span> ((omr_bln <span class="sc">/</span> omr_cfl)<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span><span class="sc">-</span>sigma)) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb101-12"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_omr_full =</span> ((omr_bln <span class="sc">/</span> omr_full)<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span><span class="sc">-</span>sigma)) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb101-13"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_xi_cfl =</span> (xi_bln <span class="sc">/</span> xi_cfl <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb101-14"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_xi_full =</span> (xi_bln <span class="sc">/</span> xi_full <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb101-15"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb101-16"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-16" aria-hidden="true" tabindex="-1"></a> <span class="fu">select</span>(exporter, <span class="fu">starts_with</span>(<span class="st">&quot;change&quot;</span>), <span class="fu">starts_with</span>(<span class="st">&quot;y&quot;</span>))</span>
<span id="cb101-17"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-18"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-18" aria-hidden="true" tabindex="-1"></a>importer_indexes <span class="ot">&lt;-</span> ch2_application2 <span class="sc">%&gt;%</span></span>
<span id="cb101-19"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(importer, imr_bln, imr_cfl, imr_full) <span class="sc">%&gt;%</span></span>
<span id="cb101-20"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-21"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">importer =</span> <span class="fu">ifelse</span>(importer <span class="sc">==</span> <span class="st">&quot;0-DEU&quot;</span>, <span class="st">&quot;DEU&quot;</span>, importer)) <span class="sc">%&gt;%</span></span>
<span id="cb101-22"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(importer) <span class="sc">%&gt;%</span></span>
<span id="cb101-23"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb101-24"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_imr_cfl =</span> ((imr_bln <span class="sc">/</span> imr_cfl)<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> sigma)) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb101-25"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_imr_full =</span> ((imr_bln <span class="sc">/</span> imr_full)<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> sigma)) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb101-26"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb101-26" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Finally, we can replicate the table that we wanted to.</p>
<pre><code>## # A tibble: 69 × 7
##    exporter change_xi_cfl change_xi_full change_rgdp_full change_im…¹ chang…² chang…³
##    &lt;chr&gt;            &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 ARG              -0.66          -0.69            -0.01        0.01    0       0   
##  2 AUS              -0.49          -0.51            -0.01        0.02   -0.01    0.01
##  3 AUT              -0.07          -0.1             -0.01        0       0.01   -0.01
##  4 BEL              -0.09          -0.12             0           0       0       0   
##  5 BGR              -0.05          -0.07             0           0       0       0   
##  6 BOL              -0.47          -0.48            -0.02        0.03   -0.01    0.01
##  7 BRA              -0.65          -0.69            -0.01       -0.01    0.02   -0.02
##  8 CAN              35.0           37.5              3.4        -1.48   -2.14    1.84
##  9 CHE              -0.14          -0.17            -0.01        0       0.01   -0.01
## 10 CHL              -0.81          -0.83            -0.03        0.01    0.03   -0.03
## # … with 59 more rows, and abbreviated variable names ¹​change_imr_full,
## #   ²​change_omr_full, ³​change_p_i_full
## # ℹ Use `print(n = ...)` to see more rows</code></pre>
<!-- Here we don't print the raw table, we format it as HTML in a separate block -->
<div id="htmlwidget-f0353b103071056224eb" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f0353b103071056224eb">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69"],["ARG","AUS","AUT","BEL","BGR","BOL","BRA","CAN","CHE","CHL","CHN","CMR","COL","CRI","CYP","DEU","DNK","ECU","EGY","ESP","FIN","FRA","GBR","GRC","HKG","HUN","IDN","IND","IRL","IRN","ISL","ISR","ITA","JOR","JPN","KEN","KOR","KWT","LKA","MAC","MAR","MEX","MLT","MMR","MUS","MWI","MYS","NER","NGA","NLD","NOR","NPL","PAN","PHL","POL","PRT","QAT","ROM","SEN","SGP","SWE","THA","TTO","TUN","TUR","TZA","URY","USA","ZAF"],[-0.66,-0.49,-0.07,-0.09,-0.05,-0.47,-0.65,34.99,-0.14,-0.81,-0.34,-0.13,-1.8,-1.03,-0.09,-0.14,-0.06,-0.93,-0.31,-0.13,-0.09,-0.13,-0.23,-0.08,-0.2,-0.04,-0.19,-0.3,-0.1,-0.13,-0.23,-0.38,-0.12,-0.28,-0.35,-0.22,-0.41,-0.23,-0.3,-0.21,-0.08,41.64,-0.13,-0.13,-0.06,-0.18,-0.22,-0.11,-0.37,-0.07,-0.24,-0.22,-0.6,-0.29,-0.05,-0.06,-0.19,-0.08,-0.08,-0.15,-0.11,-0.25,-0.86,-0.04,-0.14,-0.16,-0.42,14.48,-0.31],[-0.69,-0.51,-0.1,-0.12,-0.07,-0.48,-0.69,37.46,-0.17,-0.83,-0.38,-0.16,-1.73,-1.04,-0.11,-0.17,-0.09,-0.89,-0.33,-0.15,-0.11,-0.15,-0.25,-0.11,-0.23,-0.07,-0.24,-0.33,-0.13,-0.16,-0.25,-0.41,-0.15,-0.3,-0.42,-0.24,-0.45,-0.26,-0.33,-0.24,-0.1,43.51,-0.15,-0.18,-0.09,-0.19,-0.27,-0.13,-0.39,-0.09,-0.25,-0.25,-0.62,-0.33,-0.07,-0.08,-0.22,-0.1,-0.1,-0.19,-0.13,-0.29,-0.88,-0.07,-0.16,-0.17,-0.44,14.88,-0.34],[-0.01,-0.01,-0.01,-0,-0,-0.02,-0.01,3.4,-0.01,-0.03,-0.01,-0.01,-0.03,-0.07,-0,-0.01,-0.01,-0.02,-0.01,-0.01,-0.01,-0.01,-0.01,-0,-0.02,-0,-0.01,-0.01,-0.03,-0,-0.01,-0.02,-0.01,-0,-0.01,-0,-0.02,-0.01,-0.01,-0.05,-0,3.81,-0.02,-0,-0.01,-0.01,-0.03,-0.02,-0,-0.01,-0.01,-0.01,-0.02,-0.03,-0,-0,-0.01,-0,-0,-0.03,-0.01,-0.01,-0.08,-0,-0,-0.01,-0.02,0.33,-0.01],[0.01,0.02,0,0,0,0.03,-0.01,-1.48,0,0.01,-0.01,0.01,0.09,0.06,0.01,0,0,0.08,0.02,0,-0,0,0.01,0.01,0.01,-0,-0,0.01,0.01,0.01,0.02,0.02,0,0.02,-0.02,0.02,-0.01,0.01,0.02,0.02,0,-2.4,0.01,0.01,0.01,0.02,0.01,0.02,0.03,0,0.02,0.02,0.03,0.01,0,0,0.01,0,0.01,0.01,0,-0,0.02,0,0,0.02,0.01,-0.18,0.01],[0,-0.01,0.01,0,0,-0.01,0.02,-2.14,0.01,0.03,0.03,-0,-0.07,0.01,-0.01,0.01,0.01,-0.06,-0.02,0.01,0.01,0.01,0.01,-0,0.01,0.01,0.01,0,0.02,-0.01,-0.01,0,0.01,-0.02,0.03,-0.02,0.03,0,-0.01,0.03,-0,-1.52,0.01,-0.01,0,-0.01,0.03,0.01,-0.03,0.01,-0,-0.01,-0,0.02,0,0,0.01,0,-0.01,0.02,0.01,0.02,0.07,-0,0,-0.01,0.01,-0.17,-0],[-0,0.01,-0.01,-0,-0,0.01,-0.02,1.84,-0.01,-0.03,-0.02,0,0.06,-0.01,0.01,-0.01,-0.01,0.05,0.01,-0.01,-0.01,-0,-0,0,-0.01,-0,-0.01,-0,-0.02,0.01,0.01,-0,-0.01,0.02,-0.03,0.02,-0.02,-0,0,-0.02,0,1.3,-0.01,0.01,-0,0.01,-0.02,-0.01,0.02,-0.01,0,0.01,0,-0.02,-0,-0,-0.01,-0,0.01,-0.02,-0.01,-0.01,-0.06,0,-0,0.01,-0.01,0.15,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>exporter<\/th>\n      <th>change_xi_cfl<\/th>\n      <th>change_xi_full<\/th>\n      <th>change_rgdp_full<\/th>\n      <th>change_imr_full<\/th>\n      <th>change_omr_full<\/th>\n      <th>change_p_i_full<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

</div>
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-yotov2016advanced" class="csl-entry">
Yotov, Yoto V, Roberta Piermartini, José-Antonio Monteiro, and Mario Larch. 2016. <em>An Advanced Guide to Trade Policy Analysis: The Structural Gravity Model</em>. World Trade Organization Geneva.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 General equilibrium trade policy analysis with structural gravity | Solutions Manual for An Advanced Guide to Trade Policy Analysis</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 General equilibrium trade policy analysis with structural gravity | Solutions Manual for An Advanced Guide to Trade Policy Analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 General equilibrium trade policy analysis with structural gravity | Solutions Manual for An Advanced Guide to Trade Policy Analysis" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Mauricio “Pachá” Vargas Sepúlveda" />


<meta name="date" content="2020-10-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"/>
<link rel="next" href="data.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Solutions Manual for An Advanced Guide to Trade Policy Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#welcome"><i class="fa fa-check"></i><b>1.1</b> Welcome</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#obtaining-the-datasets-and-functions"><i class="fa fa-check"></i><b>1.2</b> Obtaining the datasets and functions</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#getting-the-most-out-of-this-material"><i class="fa fa-check"></i><b>1.3</b> Getting the most out of this material</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><i class="fa fa-check"></i><b>2</b> Partial equilibrium trade policy analysis with structural gravity</a><ul>
<li class="chapter" data-level="2.1" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#traditional-gravity-estimates"><i class="fa fa-check"></i><b>2.1</b> Traditional Gravity Estimates</a><ul>
<li class="chapter" data-level="2.1.1" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#preparing-the-data"><i class="fa fa-check"></i><b>2.1.1</b> Preparing the data</a></li>
<li class="chapter" data-level="2.1.2" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ols-estimation-ignoring-multilateral-resistance-terms"><i class="fa fa-check"></i><b>2.1.2</b> OLS estimation ignoring multilateral resistance terms</a></li>
<li class="chapter" data-level="2.1.3" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ols-estimation-controlling-for-multilateral-resistance-terms-with-remote-indexes"><i class="fa fa-check"></i><b>2.1.3</b> OLS estimation controlling for multilateral resistance terms with remote indexes</a></li>
<li class="chapter" data-level="2.1.4" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ols-estimation-controlling-for-multilateral-resistance-terms-with-fixed-effects"><i class="fa fa-check"></i><b>2.1.4</b> OLS estimation controlling for multilateral resistance terms with fixed effects</a></li>
<li class="chapter" data-level="2.1.5" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ppml-estimation-controlling-for-multilateral-resistance-terms-with-fixed-effects"><i class="fa fa-check"></i><b>2.1.5</b> PPML estimation controlling for multilateral resistance terms with fixed effects</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#the-distance-puzzle-resolved"><i class="fa fa-check"></i><b>2.2</b> The “distance puzzle” resolved</a><ul>
<li class="chapter" data-level="2.2.1" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#preparing-the-data-1"><i class="fa fa-check"></i><b>2.2.1</b> Preparing the data</a></li>
<li class="chapter" data-level="2.2.2" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ols-solution-for-the-distance-puzzle"><i class="fa fa-check"></i><b>2.2.2</b> OLS solution for the “distance puzzle”</a></li>
<li class="chapter" data-level="2.2.3" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ppml-solution-for-the-distance-puzzle"><i class="fa fa-check"></i><b>2.2.3</b> PPML solution for the “distance puzzle”</a></li>
<li class="chapter" data-level="2.2.4" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#internal-distance-solution-for-the-distance-puzzle"><i class="fa fa-check"></i><b>2.2.4</b> Internal distance solution for the “distance puzzle”</a></li>
<li class="chapter" data-level="2.2.5" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#internal-distance-and-home-bias-solution-for-the-distance-puzzle"><i class="fa fa-check"></i><b>2.2.5</b> Internal distance and home bias solution for the “distance puzzle”</a></li>
<li class="chapter" data-level="2.2.6" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#fixed-effects-solution-for-the-distance-puzzle"><i class="fa fa-check"></i><b>2.2.6</b> Fixed effects solution for the “distance puzzle”</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#regional-trade-agreements-effects"><i class="fa fa-check"></i><b>2.3</b> Regional trade agreements effects</a><ul>
<li class="chapter" data-level="2.3.1" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#preparing-the-data-2"><i class="fa fa-check"></i><b>2.3.1</b> Preparing the data</a></li>
<li class="chapter" data-level="2.3.2" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ols-standard-rta-estimates-with-international-trade-only"><i class="fa fa-check"></i><b>2.3.2</b> OLS standard RTA estimates with international trade only</a></li>
<li class="chapter" data-level="2.3.3" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ppml-standard-rta-estimates-with-international-trade-only"><i class="fa fa-check"></i><b>2.3.3</b> PPML standard RTA estimates with international trade only</a></li>
<li class="chapter" data-level="2.3.4" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#addressing-potential-domestic-trade-diversion"><i class="fa fa-check"></i><b>2.3.4</b> Addressing potential domestic trade diversion</a></li>
<li class="chapter" data-level="2.3.5" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#addressing-potential-endogeneity-of-rtas"><i class="fa fa-check"></i><b>2.3.5</b> Addressing potential endogeneity of RTAs</a></li>
<li class="chapter" data-level="2.3.6" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#testing-for-potential-reverse-causality-between-trade-and-rtas"><i class="fa fa-check"></i><b>2.3.6</b> Testing for potential “reverse causality” between trade and RTAs</a></li>
<li class="chapter" data-level="2.3.7" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#addressing-potential-non-linear-and-phasing-in-effects-of-rtas"><i class="fa fa-check"></i><b>2.3.7</b> Addressing potential non-linear and phasing-in effects of RTAs</a></li>
<li class="chapter" data-level="2.3.8" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#addressing-globalization-effects"><i class="fa fa-check"></i><b>2.3.8</b> Addressing globalization effects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><i class="fa fa-check"></i><b>3</b> General equilibrium trade policy analysis with structural gravity</a><ul>
<li class="chapter" data-level="3.1" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#trade-without-borders"><i class="fa fa-check"></i><b>3.1</b> Trade without borders</a><ul>
<li class="chapter" data-level="3.1.1" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#initial-data"><i class="fa fa-check"></i><b>3.1.1</b> Initial data</a></li>
<li class="chapter" data-level="3.1.2" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-i-solve-the-baseline-model"><i class="fa fa-check"></i><b>3.1.2</b> Step I: Solve the baseline model</a></li>
<li class="chapter" data-level="3.1.3" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-ii-define-a-counterfactual-scenario"><i class="fa fa-check"></i><b>3.1.3</b> Step II: Define a counterfactual scenario</a></li>
<li class="chapter" data-level="3.1.4" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-iii-solve-the-counterfactual-model"><i class="fa fa-check"></i><b>3.1.4</b> Step III: Solve the counterfactual model</a></li>
<li class="chapter" data-level="3.1.5" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-iv-collect-construct-and-report-indexes-of-interest"><i class="fa fa-check"></i><b>3.1.5</b> Step IV: Collect, construct, and report indexes of interest</a></li>
<li class="chapter" data-level="3.1.6" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#figures-replication"><i class="fa fa-check"></i><b>3.1.6</b> Figures replication</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>4</b> Appendix: Importing the original datasets</a><ul>
<li class="chapter" data-level="4.1" data-path="data.html"><a href="data.html#software"><i class="fa fa-check"></i><b>4.1</b> Software</a></li>
<li class="chapter" data-level="4.2" data-path="data.html"><a href="data.html#downloading-the-original-datasets"><i class="fa fa-check"></i><b>4.2</b> Downloading the original datasets</a></li>
<li class="chapter" data-level="4.3" data-path="data.html"><a href="data.html#converting-the-original-datasets"><i class="fa fa-check"></i><b>4.3</b> Converting the original datasets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://www.unescap.org/" target="blank">UN ESCAP - Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Solutions Manual for An Advanced Guide to Trade Policy Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="general-equilibrium-trade-policy-analysis-with-structural-gravity" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> General equilibrium trade policy analysis with structural gravity</h1>
<div id="trade-without-borders" class="section level2">
<h2><span class="header-section-number">3.1</span> Trade without borders</h2>
<div id="initial-data" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Initial data</h3>
<p>Unlike the previous chapter, we shall proceed by alternating both data transforming and regressions. In the previous chapter it was possible to first process the datasets and then fit the regressions, but here we need the regressions’ output in order to create new variables. In any case we will follow quite similar steps to the last chapter.</p>
<p>To do what is shown in box #1 from page 104 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span>, we need to convert “DEU” in both exporter and importer columns to “0-DEU”. We could have used “AAA”, the book uses “ZZZ” but in R “ZZZ” won’t be treated as the reference factor. It is important to mention that box #1 doesn’t show a previous step that is mentioned in page 103, which is to filter and keep observations for the year 2006 only.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb1-1"></a>ch2_application1 &lt;-<span class="st"> </span><span class="kw">yotov_data</span>(<span class="st">&quot;ch2_application1&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb1-2"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2006</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb1-3"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb1-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb1-4"></a>    <span class="dt">log_dist =</span> <span class="kw">log</span>(dist),</span>
<span id="cb1-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb1-5"></a>    <span class="dt">intl =</span> <span class="kw">ifelse</span>(exporter <span class="op">!=</span><span class="st"> </span>importer, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb1-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb1-6"></a>    <span class="dt">exporter =</span> <span class="kw">ifelse</span>(exporter <span class="op">==</span><span class="st"> &quot;DEU&quot;</span>, <span class="st">&quot;0-DEU&quot;</span>, exporter),</span>
<span id="cb1-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb1-7"></a>    <span class="dt">importer =</span> <span class="kw">ifelse</span>(importer <span class="op">==</span><span class="st"> &quot;DEU&quot;</span>, <span class="st">&quot;0-DEU&quot;</span>, importer)</span>
<span id="cb1-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb1-8"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb1-9"></a><span class="st">  </span></span>
<span id="cb1-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb1-10"></a><span class="st">  </span><span class="co"># Create Yit</span></span>
<span id="cb1-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb1-11"></a><span class="st">  </span><span class="kw">group_by</span>(exporter, year) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-12"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb1-12"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y =</span> <span class="kw">sum</span>(trade)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-13"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb1-13"></a><span class="st">  </span></span>
<span id="cb1-14"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb1-14"></a><span class="st">  </span><span class="co"># Create Eit</span></span>
<span id="cb1-15"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb1-15"></a><span class="st">  </span><span class="kw">group_by</span>(importer, year) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-16"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb1-16"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">e =</span> <span class="kw">sum</span>(trade)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-17"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb1-17"></a><span class="st">  </span></span>
<span id="cb1-18"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb1-18"></a><span class="st">  </span><span class="co"># Create Er</span></span>
<span id="cb1-19"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb1-19"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-20"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb1-20"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">e_r =</span> <span class="kw">max</span>(<span class="kw">ifelse</span>(importer <span class="op">==</span><span class="st"> &quot;0-DEU&quot;</span>, e, <span class="ot">NA</span>), <span class="dt">na.rm =</span> T))</span></code></pre></div>
</div>
<div id="step-i-solve-the-baseline-model" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Step I: Solve the baseline model</h3>
<p>We start by fitting the next model:</p>
<p><span class="math display">\[
\begin{align}
X_{ij,t} =&amp; \:\exp\left[\pi_{i,t} + \chi_{i,t} + \beta_1 \log(DIST)_{i,j} + \beta_2 CNTG_{i,j} + \beta_3 INTL_{i,j}\right] \times \varepsilon_{ij,t}
\end{align}
\]</span></p>
<p>With the data from above, the model specification is straightforward:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb2-1"></a>fit_baseline &lt;-<span class="st"> </span><span class="kw">glm</span>(</span>
<span id="cb2-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb2-2"></a>  trade <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>log_dist <span class="op">+</span><span class="st"> </span>cntg <span class="op">+</span><span class="st"> </span>intl <span class="op">+</span><span class="st"> </span>exporter <span class="op">+</span><span class="st"> </span>importer,</span>
<span id="cb2-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb2-3"></a>  <span class="dt">family =</span> <span class="kw">quasipoisson</span>(<span class="dt">link =</span> <span class="st">&quot;log&quot;</span>),</span>
<span id="cb2-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb2-4"></a>  <span class="dt">data =</span> ch2_application1</span>
<span id="cb2-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb2-5"></a>)</span></code></pre></div>
<p>For now, we will concentrate on the fitted values and shall ignore the clustered standard errors in the next paragraphs, but still we can show the robust estimation by using the <code>yotov_robust_glm()</code> function:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb3-1"></a><span class="kw">yotov_robust_glm</span>(fit_baseline<span class="op">$</span>formula, ch2_application1)</span></code></pre></div>
<pre><code>## 
## z test of coefficients:
## 
##           Estimate Std. Error  z value  Pr(&gt;|z|)    
## log_dist -0.791288   0.062781 -12.6040 &lt; 2.2e-16 ***
## cntg      0.673646   0.139803   4.8185 1.446e-06 ***
## intl     -2.474450   0.149266 -16.5775 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>With the estimated model, we can proceed as in box #1 from page 105 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span> in order to construct the variables for export and import fixed effects:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb5-1"></a>ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb5-2"></a><span class="st">  </span><span class="kw">left_join</span>(<span class="kw">yotov_fixed_effects</span>(fit_baseline))</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;exporter&quot;, &quot;importer&quot;)</code></pre>
<p>Still following box #1, we need to compute the variables of bilateral trade costs and multilateral resistances:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb7-1"></a>ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb7-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb7-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb7-3"></a>    <span class="dt">tij_bln =</span> <span class="kw">exp</span>(fit_baseline<span class="op">$</span>coefficients[<span class="st">&quot;log_dist&quot;</span>] <span class="op">*</span><span class="st"> </span>log_dist <span class="op">+</span></span>
<span id="cb7-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb7-4"></a><span class="st">                  </span>fit_baseline<span class="op">$</span>coefficients[<span class="st">&quot;cntg&quot;</span>] <span class="op">*</span><span class="st"> </span>cntg <span class="op">+</span></span>
<span id="cb7-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb7-5"></a><span class="st">                  </span>fit_baseline<span class="op">$</span>coefficients[<span class="st">&quot;intl&quot;</span>] <span class="op">*</span><span class="st"> </span>intl),</span>
<span id="cb7-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb7-6"></a>  </span>
<span id="cb7-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb7-7"></a>    <span class="co"># outward multilateral resistance (omr)</span></span>
<span id="cb7-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb7-8"></a>    <span class="dt">omr_bln =</span> y <span class="op">*</span><span class="st"> </span>(e_r <span class="op">/</span><span class="st"> </span><span class="kw">exp</span>(fe_exporter)),</span>
<span id="cb7-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb7-9"></a>    </span>
<span id="cb7-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb7-10"></a>    <span class="co"># inward multilateral resistance (imr)</span></span>
<span id="cb7-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb7-11"></a>    <span class="dt">imr_bln =</span> e <span class="op">/</span><span class="st"> </span>(<span class="kw">exp</span>(fe_importer) <span class="op">*</span><span class="st"> </span>e_r)</span>
<span id="cb7-12"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb7-12"></a>  )</span></code></pre></div>
<p>To complete this stage of the estimation, we need to create a column with the estimated international trade for given output and expenditures. We start by adding a column, <code>tradehat_bln</code>, with the regression output, and then we group by exporter and summarise to obtain the required column <code>xi_bln</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb8-1"></a>ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb8-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb8-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tradehat_bln =</span> fit_baseline<span class="op">$</span>fitted.values) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb8-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb8-3"></a><span class="st">  </span><span class="kw">group_by</span>(exporter) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb8-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb8-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">xi_bln =</span> <span class="kw">sum</span>(tradehat_bln <span class="op">*</span><span class="st"> </span>(exporter <span class="op">!=</span><span class="st"> </span>importer))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb8-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb8-5"></a><span class="st">  </span><span class="kw">ungroup</span>()</span></code></pre></div>
</div>
<div id="step-ii-define-a-counterfactual-scenario" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Step II: Define a counterfactual scenario</h3>
<p>Box #2 from page 105 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span> proposes two alternatives to define counterfactual scenario of removing international borders.</p>
<p>The first alternative is to eliminate the border variable and then generate the logged trade costs used in the constraint:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb9-1"></a>ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb9-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb9-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb9-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb9-3"></a>    <span class="dt">tij_cfl =</span> <span class="kw">exp</span>(fit_baseline<span class="op">$</span>coefficients[<span class="st">&quot;log_dist&quot;</span>] <span class="op">*</span><span class="st"> </span>log_dist <span class="op">+</span></span>
<span id="cb9-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb9-4"></a><span class="st">                  </span>fit_baseline<span class="op">$</span>coefficients[<span class="st">&quot;cntg&quot;</span>] <span class="op">*</span><span class="st"> </span>cntg),</span>
<span id="cb9-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb9-5"></a>    <span class="dt">log_tij_cfl =</span> <span class="kw">log</span>(tij_cfl)</span>
<span id="cb9-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb9-6"></a>  )</span></code></pre></div>
<p>The second alternative is to define a new counterfactual border variable:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb10-1"></a>ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb10-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb10-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb10-3"></a>    <span class="dt">intl_cfl =</span> <span class="dv">0</span>,</span>
<span id="cb10-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb10-4"></a>    <span class="dt">tij_bln =</span> <span class="kw">exp</span>(fit_baseline<span class="op">$</span>coefficients[<span class="st">&quot;log_dist&quot;</span>] <span class="op">*</span><span class="st"> </span>log_dist <span class="op">+</span></span>
<span id="cb10-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb10-5"></a><span class="st">                  </span>fit_baseline<span class="op">$</span>coefficients[<span class="st">&quot;cntg&quot;</span>] <span class="op">*</span><span class="st"> </span>cntg <span class="op">+</span></span>
<span id="cb10-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb10-6"></a><span class="st">                  </span>fit_baseline<span class="op">$</span>coefficients[<span class="st">&quot;intl&quot;</span>] <span class="op">*</span><span class="st"> </span>intl_cfl),</span>
<span id="cb10-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb10-7"></a>    <span class="dt">log_tij_cfl =</span> <span class="kw">log</span>(tij_cfl)</span>
<span id="cb10-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb10-8"></a>  )</span></code></pre></div>
</div>
<div id="step-iii-solve-the-counterfactual-model" class="section level3">
<h3><span class="header-section-number">3.1.4</span> Step III: Solve the counterfactual model</h3>
<p>We need to fit a model similar to the model from step I, the constrained gravity model, where <span class="math inline">\(\pi_{j,t}\)</span> and <span class="math inline">\(\chi_{j,t}\)</span> are altered:</p>
<p><span class="math display">\[
\begin{align}
X_{ij,t} =&amp; \:\exp\left[\pi_{i,t}^{CFL} + \chi_{i,t}^{CFL} + \beta_1 \log(DIST)_{i,j} + \beta_2 CNTG_{i,j} + \beta_3 INTL_{i,j}\right] \times \varepsilon_{ij,t}
\end{align}
\]</span></p>
<p>Box #1 from page 106 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span> estimates the constrained gravity model with the PPML estimator by using an offset argument, and this is straightforward in R:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb11-1"></a>fit_counterfactual &lt;-<span class="st"> </span><span class="kw">glm</span>(</span>
<span id="cb11-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb11-2"></a>  trade <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>exporter <span class="op">+</span><span class="st"> </span>importer <span class="op">+</span><span class="st"> </span><span class="kw">offset</span>(log_tij_cfl),</span>
<span id="cb11-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb11-3"></a>  <span class="dt">family =</span> <span class="kw">quasipoisson</span>(<span class="dt">link =</span> <span class="st">&quot;log&quot;</span>),</span>
<span id="cb11-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb11-4"></a>  <span class="dt">data =</span> ch2_application1</span>
<span id="cb11-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb11-5"></a>)</span></code></pre></div>
<p>Unlike step I, to construct the variables for export and import fixed effects, we’ll obtain the variables <code>fe_exporter.x</code> and <code>fe_exporter.y</code> because we already added an <code>fe_exporter</code> column to the dataset after obtaining the baseline model.</p>
<p><code>dplyr</code> is wise enough to rename the two <code>fe_exporter</code> columns (the same applies to the imports) but we need to specify that we want to join by exporter and importer instead of all columns with shared names. In any case, it is better to rename those columns and provide informative names:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb12-1"></a>ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb12-2"></a><span class="st">  </span><span class="kw">left_join</span>(</span>
<span id="cb12-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb12-3"></a>    <span class="kw">yotov_fixed_effects</span>(fit_counterfactual),</span>
<span id="cb12-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb12-4"></a>    <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;exporter&quot;</span>, <span class="st">&quot;importer&quot;</span>)</span>
<span id="cb12-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb12-5"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb12-6"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb12-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb12-7"></a>    <span class="dt">fe_exporter_bln =</span> fe_exporter.x,</span>
<span id="cb12-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb12-8"></a>    <span class="dt">fe_exporter_cfl =</span> fe_exporter.y,</span>
<span id="cb12-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb12-9"></a>    <span class="dt">fe_importer_bln =</span> fe_importer.x,</span>
<span id="cb12-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb12-10"></a>    <span class="dt">fe_importer_cfl =</span> fe_importer.y</span>
<span id="cb12-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb12-11"></a>  )</span></code></pre></div>
<p>Now we go for Box #2 from page 106 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span> where the variables of bilateral trade costs and multilateral resistances are obtained:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb13-1"></a>ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb13-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb13-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb13-3"></a>    <span class="co"># outward multilateral resistance (omr)</span></span>
<span id="cb13-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb13-4"></a>    <span class="dt">omr_cfl =</span> y <span class="op">*</span><span class="st"> </span>(e_r <span class="op">/</span><span class="st"> </span><span class="kw">exp</span>(fe_exporter_cfl)),</span>
<span id="cb13-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb13-5"></a></span>
<span id="cb13-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb13-6"></a>    <span class="co"># inward multilateral resistance (imr)</span></span>
<span id="cb13-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb13-7"></a>    <span class="dt">imr_cfl =</span> e <span class="op">/</span><span class="st"> </span>(<span class="kw">exp</span>(fe_importer_cfl) <span class="op">*</span><span class="st"> </span>e_r)</span>
<span id="cb13-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb13-8"></a>  )</span></code></pre></div>
<p>Box #2 also shows how to compute the conditional general equilibrium effects of trade. This is very similar to what we did in step I:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb14-1"></a>ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb14-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tradehat_cfl =</span> fit_counterfactual<span class="op">$</span>fitted.values) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb14-3"></a><span class="st">  </span><span class="kw">group_by</span>(exporter) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb14-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">xi_cfl =</span> <span class="kw">sum</span>(tradehat_cfl <span class="op">*</span><span class="st"> </span>(exporter <span class="op">!=</span><span class="st"> </span>importer))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb14-5"></a><span class="st">  </span><span class="kw">ungroup</span>()</span></code></pre></div>
<p>Box #1 from page 107 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span> can be considerably simplified with R code. To construct the iterative procedure to converge to full endowment general equilibrium effects, we start by creating the required columns and parameters, so we will deviate from the original approach.</p>
<p>We start computing change in bilateral trade costs (<code>change_tij</code>) and trade deficit or surplus (<code>phi</code>):</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb15-1"></a><span class="co"># set the criteria of convergence</span></span>
<span id="cb15-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb15-2"></a><span class="co"># taken from the literature (see the Stata code)</span></span>
<span id="cb15-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb15-3"></a>sigma &lt;-<span class="st"> </span><span class="dv">7</span></span>
<span id="cb15-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb15-4"></a></span>
<span id="cb15-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb15-5"></a>ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb15-6"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb15-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb15-7"></a>    <span class="dt">change_tij =</span> tij_cfl <span class="op">/</span><span class="st"> </span>tij_bln,</span>
<span id="cb15-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb15-8"></a>    <span class="dt">phi =</span> <span class="kw">ifelse</span>(importer <span class="op">==</span><span class="st"> </span>exporter, e <span class="op">/</span><span class="st"> </span>y, <span class="dv">0</span>)</span>
<span id="cb15-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb15-9"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb15-10"></a><span class="st">  </span><span class="kw">group_by</span>(exporter) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb15-11"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">phi =</span> <span class="kw">max</span>(phi)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-12"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb15-12"></a><span class="st">  </span><span class="kw">ungroup</span>()</span></code></pre></div>
<p>Now we compute change in prices for exporters (<code>change_p_i</code>) and importers (<code>change_p_j</code>):</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb16-1"></a>ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb16-2"></a><span class="st">  </span><span class="kw">group_by</span>(exporter) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb16-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">change_p_i =</span> ((<span class="kw">exp</span>(fe_exporter_cfl) <span class="op">/</span><span class="st"> </span>e_r) <span class="op">/</span><span class="st"> </span>(<span class="kw">exp</span>(fe_exporter_bln) <span class="op">/</span><span class="st"> </span>e_r))<span class="op">^</span>(<span class="dv">1</span> <span class="op">/</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>sigma))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb16-4"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb16-5"></a><span class="st">  </span></span>
<span id="cb16-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb16-6"></a><span class="st">  </span><span class="kw">group_by</span>(importer) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb16-7"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb16-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb16-8"></a>    <span class="dt">change_p_j =</span> <span class="kw">ifelse</span>(importer <span class="op">==</span><span class="st"> </span>exporter, change_p_i, <span class="dv">0</span>),</span>
<span id="cb16-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb16-9"></a>    <span class="dt">change_p_j =</span> <span class="kw">max</span>(change_p_j)</span>
<span id="cb16-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb16-10"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb16-11"></a><span class="st">  </span><span class="kw">ungroup</span>()</span></code></pre></div>
<p>Next, we need to compute the counterfactual trade flows (<code>trade_cfl</code>):</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb17-1"></a>ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb17-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">trade_cfl =</span> tradehat_cfl <span class="op">*</span><span class="st"> </span>change_p_i <span class="op">*</span><span class="st"> </span>change_p_j)</span></code></pre></div>
<p>To conclude the steps from Box #1 we need a <code>while()</code> loop and iterate until a convergence is reached.</p>
<p>We need to duplicate some columns under new names for the loop operations, because we will overwrite them when using the iterative steps:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb18-1"></a>ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb18-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb18-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb18-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb18-3"></a>    <span class="dt">omr_cfl_0 =</span> omr_cfl,</span>
<span id="cb18-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb18-4"></a>    <span class="dt">imr_cfl_0 =</span> imr_cfl,</span>
<span id="cb18-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb18-5"></a>    <span class="dt">change_imr_full_0 =</span> <span class="dv">1</span>,</span>
<span id="cb18-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb18-6"></a>    <span class="dt">change_omr_full_0 =</span> <span class="dv">1</span>,</span>
<span id="cb18-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb18-7"></a>    <span class="dt">change_p_i_0 =</span> change_p_i,</span>
<span id="cb18-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb18-8"></a>    <span class="dt">change_p_j_0 =</span> change_p_j,</span>
<span id="cb18-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb18-9"></a>    <span class="dt">fe_exporter_cfl_0 =</span> fe_exporter_cfl,</span>
<span id="cb18-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb18-10"></a>    <span class="dt">fe_importer_cfl_0 =</span> fe_importer_cfl,</span>
<span id="cb18-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb18-11"></a>    <span class="dt">tradehat_0 =</span> tradehat_cfl,</span>
<span id="cb18-12"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb18-12"></a>    <span class="dt">e_r_cfl_0 =</span> e_r</span>
<span id="cb18-13"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb18-13"></a>  )</span></code></pre></div>
<p>And now we run the loop, which cannot be divided into smaller pieces because the step <span class="math inline">\(N\)</span> depends on the step <span class="math inline">\(N-1\)</span>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-1"></a><span class="co"># set parameters</span></span>
<span id="cb19-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-2"></a>max_dif &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb19-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-3"></a>sd_dif &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb19-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-4"></a>change_price_i_old &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb19-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-5"></a></span>
<span id="cb19-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-6"></a><span class="cf">while</span>(sd_dif <span class="op">&gt;</span><span class="st"> </span><span class="fl">1e-5</span> <span class="op">|</span><span class="st"> </span>max_dif <span class="op">&gt;</span><span class="st"> </span><span class="fl">1e-5</span>) {</span>
<span id="cb19-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-7"></a>  ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-8"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">trade_1 =</span> tradehat_<span class="dv">0</span> <span class="op">*</span><span class="st"> </span>change_p_i_<span class="dv">0</span> <span class="op">*</span><span class="st"> </span>change_p_j_<span class="dv">0</span> <span class="op">/</span><span class="st"> </span>(change_omr_full_<span class="dv">0</span> <span class="op">*</span><span class="st"> </span>change_imr_full_<span class="dv">0</span>))</span>
<span id="cb19-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-9"></a>  </span>
<span id="cb19-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-10"></a>  <span class="co"># repeat the counterfactual model</span></span>
<span id="cb19-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-11"></a>  fit_counterfactual_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">glm</span>(</span>
<span id="cb19-12"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-12"></a>    trade_<span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>exporter <span class="op">+</span><span class="st"> </span>importer <span class="op">+</span><span class="st"> </span><span class="kw">offset</span>(log_tij_cfl),</span>
<span id="cb19-13"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-13"></a>    <span class="dt">family =</span> <span class="kw">quasipoisson</span>(<span class="dt">link =</span> <span class="st">&quot;log&quot;</span>),</span>
<span id="cb19-14"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-14"></a>    <span class="dt">data =</span> ch2_application1</span>
<span id="cb19-15"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-15"></a>  )</span>
<span id="cb19-16"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-16"></a>  </span>
<span id="cb19-17"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-17"></a>  ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-18"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-18"></a><span class="st">    </span><span class="kw">left_join</span>(</span>
<span id="cb19-19"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-19"></a>      <span class="kw">yotov_fixed_effects</span>(fit_counterfactual_<span class="dv">2</span>),</span>
<span id="cb19-20"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-20"></a>      <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;exporter&quot;</span>, <span class="st">&quot;importer&quot;</span>)</span>
<span id="cb19-21"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-21"></a>    )</span>
<span id="cb19-22"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-22"></a>  </span>
<span id="cb19-23"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-23"></a>  <span class="co"># compute the conditional general equilibrium effects of trade</span></span>
<span id="cb19-24"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-24"></a>  ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-25"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-25"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">tradehat_1 =</span> fit_counterfactual_<span class="dv">2</span><span class="op">$</span>fitted.values) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-26"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-26"></a><span class="st">    </span><span class="kw">group_by</span>(exporter) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-27"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-27"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">y_cfl_1 =</span> <span class="kw">sum</span>(tradehat_<span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-28"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-28"></a><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-29"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-29"></a><span class="st">    </span></span>
<span id="cb19-30"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-30"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">e_cfl_1 =</span> <span class="kw">ifelse</span>(importer <span class="op">==</span><span class="st"> </span>exporter, phi <span class="op">*</span><span class="st"> </span>y_cfl_<span class="dv">1</span>, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-31"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-31"></a><span class="st">    </span><span class="kw">group_by</span>(importer) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-32"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-32"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">e_cfl_1 =</span> <span class="kw">max</span>(e_cfl_<span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-33"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-33"></a><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-34"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-34"></a><span class="st">    </span></span>
<span id="cb19-35"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-35"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
<span id="cb19-36"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-36"></a>      <span class="dt">e_r_cfl_1 =</span> <span class="kw">ifelse</span>(importer <span class="op">==</span><span class="st"> &quot;0-DEU&quot;</span>, e_cfl_<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb19-37"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-37"></a>      <span class="dt">e_r_cfl_1 =</span> <span class="kw">max</span>(e_r_cfl_<span class="dv">1</span>)</span>
<span id="cb19-38"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-38"></a>    )</span>
<span id="cb19-39"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-39"></a>  </span>
<span id="cb19-40"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-40"></a>  <span class="co"># compute the change in prices for exporters and importers</span></span>
<span id="cb19-41"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-41"></a>  ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-42"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-42"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">change_p_i_1 =</span> ((<span class="kw">exp</span>(fe_exporter) <span class="op">/</span><span class="st"> </span>e_r_cfl_<span class="dv">1</span>) <span class="op">/</span><span class="st"> </span></span>
<span id="cb19-43"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-43"></a><span class="st">      </span>(<span class="kw">exp</span>(fe_exporter_cfl_<span class="dv">0</span>) <span class="op">/</span><span class="st"> </span>e_r_cfl_<span class="dv">0</span>))<span class="op">^</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>sigma)))</span>
<span id="cb19-44"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-44"></a>  </span>
<span id="cb19-45"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-45"></a>  <span class="co"># compute the change in prices for exporters and importers</span></span>
<span id="cb19-46"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-46"></a>  ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-47"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-47"></a><span class="st">    </span><span class="kw">group_by</span>(importer) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-48"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-48"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
<span id="cb19-49"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-49"></a>      <span class="dt">change_p_j_1 =</span> <span class="kw">ifelse</span>(importer <span class="op">==</span><span class="st"> </span>exporter, change_p_i_<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb19-50"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-50"></a>      <span class="dt">change_p_j_1 =</span> <span class="kw">max</span>(change_p_j_<span class="dv">1</span>)</span>
<span id="cb19-51"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-51"></a>    ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-52"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-52"></a><span class="st">    </span><span class="kw">ungroup</span>()</span>
<span id="cb19-53"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-53"></a>  </span>
<span id="cb19-54"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-54"></a>  <span class="co"># compute both outward and inward multilateral resistance</span></span>
<span id="cb19-55"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-55"></a>  ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-56"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-56"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
<span id="cb19-57"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-57"></a>      <span class="dt">omr_cfl_1 =</span> (y_cfl_<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>e_r_cfl_<span class="dv">1</span>) <span class="op">/</span><span class="st"> </span><span class="kw">exp</span>(fe_exporter),</span>
<span id="cb19-58"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-58"></a>      <span class="dt">imr_cfl_1 =</span> e_cfl_<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="kw">exp</span>(fe_importer) <span class="op">*</span><span class="st"> </span>e_r_cfl_<span class="dv">1</span>)</span>
<span id="cb19-59"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-59"></a>    )</span>
<span id="cb19-60"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-60"></a>  </span>
<span id="cb19-61"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-61"></a>  <span class="co"># update the differences</span></span>
<span id="cb19-62"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-62"></a>  max_dif &lt;-<span class="st"> </span><span class="kw">abs</span>(<span class="kw">max</span>(ch2_application1<span class="op">$</span>change_p_i_<span class="dv">0</span> <span class="op">-</span><span class="st"> </span>change_price_i_old))</span>
<span id="cb19-63"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-63"></a>  sd_dif &lt;-<span class="st"> </span><span class="kw">sd</span>(ch2_application1<span class="op">$</span>change_p_i_<span class="dv">0</span> <span class="op">-</span><span class="st"> </span>change_price_i_old)</span>
<span id="cb19-64"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-64"></a>  change_price_i_old &lt;-<span class="st"> </span>ch2_application1<span class="op">$</span>change_p_i_<span class="dv">0</span></span>
<span id="cb19-65"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-65"></a>  </span>
<span id="cb19-66"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-66"></a>  <span class="co"># compute changes in outward and inward multilateral resistance</span></span>
<span id="cb19-67"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-67"></a>  ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-68"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-68"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
<span id="cb19-69"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-69"></a>      <span class="dt">change_omr_full_1 =</span> omr_cfl_<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>omr_cfl_<span class="dv">0</span>,</span>
<span id="cb19-70"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-70"></a>      <span class="dt">change_imr_full_1 =</span> imr_cfl_<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>imr_cfl_<span class="dv">0</span>,</span>
<span id="cb19-71"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-71"></a>      <span class="dt">omr_cfl_0 =</span> omr_cfl_<span class="dv">1</span>,</span>
<span id="cb19-72"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-72"></a>      <span class="dt">imr_cfl_0 =</span> imr_cfl_<span class="dv">1</span>,</span>
<span id="cb19-73"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-73"></a>      <span class="dt">change_omr_full_0 =</span> change_omr_full_<span class="dv">1</span>,</span>
<span id="cb19-74"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-74"></a>      <span class="dt">change_imr_full_0 =</span> change_imr_full_<span class="dv">1</span>,</span>
<span id="cb19-75"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-75"></a>      <span class="dt">change_p_i_0 =</span> change_p_i_<span class="dv">1</span>,</span>
<span id="cb19-76"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-76"></a>      <span class="dt">change_p_j_0 =</span> change_p_j_<span class="dv">1</span>,</span>
<span id="cb19-77"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-77"></a>      <span class="dt">fe_exp_cfl_0 =</span> fe_exporter,</span>
<span id="cb19-78"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-78"></a>      <span class="dt">fe_imp_cfl_0 =</span> fe_importer,</span>
<span id="cb19-79"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-79"></a>      <span class="dt">tradehat_0 =</span> tradehat_<span class="dv">1</span>,</span>
<span id="cb19-80"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-80"></a>      <span class="dt">e_r_cfl_0 =</span> e_r_cfl_<span class="dv">1</span></span>
<span id="cb19-81"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-81"></a>    ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-82"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-82"></a><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>fe_exporter, <span class="op">-</span>fe_importer)</span>
<span id="cb19-83"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb19-83"></a>}</span></code></pre></div>
<p>Box #1 from page 108 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span> shows the steps to obtain different endowments, which can be divided into smaller pieces.</p>
<p>We start computing the full endowment general equilibrium of factory-gate price (<code>change_p_i_full</code> and <code>change_p_j_full</code>) and the full endowment general equilibrium of output (<code>y_full</code>):</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb20-1"></a>ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb20-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb20-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb20-3"></a>    <span class="dt">change_p_i_full =</span> ((<span class="kw">exp</span>(fe_exporter_cfl_<span class="dv">0</span>) <span class="op">/</span><span class="st"> </span>e_r_cfl_<span class="dv">0</span>) <span class="op">/</span></span>
<span id="cb20-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb20-4"></a><span class="st">                         </span>(<span class="kw">exp</span>(fe_exporter_bln) <span class="op">/</span><span class="st"> </span>e_r))<span class="op">^</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>sigma)),</span>
<span id="cb20-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb20-5"></a>    <span class="dt">change_p_j_full =</span> change_p_i_full <span class="op">*</span><span class="st"> </span>(exporter <span class="op">==</span><span class="st"> </span>importer)</span>
<span id="cb20-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb20-6"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb20-7"></a><span class="st">  </span><span class="kw">group_by</span>(importer) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb20-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">change_p_j_full =</span> <span class="kw">max</span>(change_p_j_full)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb20-9"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb20-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y_full =</span> change_p_i_full <span class="op">*</span><span class="st"> </span>y)</span></code></pre></div>
<p>Now we compute the full endowment general equilibrium of aggregate expenditures (<code>e_full</code> and <code>e_full_r</code>):</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb21-1"></a>ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb21-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb21-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">e_full =</span> change_p_j_full <span class="op">*</span><span class="st"> </span>e <span class="op">*</span><span class="st"> </span>(exporter <span class="op">==</span><span class="st"> </span>importer)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb21-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb21-3"></a><span class="st">  </span><span class="kw">group_by</span>(importer) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb21-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb21-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">e_full =</span> <span class="kw">max</span>(e_full, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb21-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb21-5"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb21-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb21-6"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb21-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb21-7"></a>    <span class="dt">e_full_r =</span> e_full <span class="op">*</span><span class="st"> </span>(importer <span class="op">==</span><span class="st"> &quot;0-DEU&quot;</span>),</span>
<span id="cb21-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb21-8"></a>    <span class="dt">e_full_r =</span> <span class="kw">max</span>(e_full_r)</span>
<span id="cb21-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb21-9"></a>  )</span></code></pre></div>
<p>With the aggregate expenditure we proceed to obtain the full endowment general equilibrium of the outward multilateral resistance (<code>omr_full</code>) and inward multilateral resistance (<code>imr_full</code>):</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb22-1"></a>ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb22-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb22-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb22-3"></a>    <span class="dt">omr_full =</span> y_full <span class="op">*</span><span class="st"> </span>e_r_cfl_<span class="dv">0</span> <span class="op">/</span><span class="st"> </span><span class="kw">exp</span>(fe_exporter_cfl_<span class="dv">0</span>),</span>
<span id="cb22-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb22-4"></a>    <span class="dt">imr_full =</span> e_full <span class="op">/</span><span class="st"> </span>(<span class="kw">exp</span>(fe_importer_cfl_<span class="dv">0</span>) <span class="op">*</span><span class="st"> </span>e_full_r)</span>
<span id="cb22-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb22-5"></a>  )</span></code></pre></div>
<p>Finally we proceed to compute the full endowment general equilibrium of trade (<code>xi_full</code>):</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb23-1"></a>ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb23-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb23-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">x_full =</span> (y_full <span class="op">*</span><span class="st"> </span>e_full <span class="op">*</span><span class="st"> </span>tij_cfl) <span class="op">/</span><span class="st"> </span>(imr_full <span class="op">*</span><span class="st"> </span>omr_full)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb23-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb23-3"></a><span class="st">  </span><span class="kw">group_by</span>(exporter) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb23-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb23-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">xi_full =</span> <span class="kw">sum</span>(x_full <span class="op">*</span><span class="st"> </span>(importer <span class="op">!=</span><span class="st"> </span>exporter))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb23-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb23-5"></a><span class="st">  </span><span class="kw">ungroup</span>()</span></code></pre></div>
</div>
<div id="step-iv-collect-construct-and-report-indexes-of-interest" class="section level3">
<h3><span class="header-section-number">3.1.5</span> Step IV: Collect, construct, and report indexes of interest</h3>
<p>Box #1 from page 108 in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span> consists in to construct the percentage change of the general equilibrium indexes. The steps are direct, we need to compute the change in full endowment general equilibrium factory-gate price on export side (<code>change_price_full</code>), the change in conditional and full general equilibrium outward multilateral resistances (<code>change_omr_*</code>), and the change in conditional and full general equilibrium international trade (<code>change_xi_*</code>):</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb24-1"></a>ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb24-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb24-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb24-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb24-3"></a>    <span class="dt">change_price_full =</span> (change_p_i_full <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb24-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb24-4"></a>    <span class="dt">change_omr_cfl =</span> (omr_cfl<span class="op">^</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>sigma)) <span class="op">/</span><span class="st"> </span>omr_bln<span class="op">^</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>sigma)) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb24-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb24-5"></a>    <span class="dt">change_omr_full =</span> (omr_full<span class="op">^</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>sigma)) <span class="op">/</span><span class="st"> </span>omr_bln<span class="op">^</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>sigma)) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb24-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb24-6"></a>    <span class="dt">change_xi_cfl =</span> (xi_cfl <span class="op">/</span><span class="st"> </span>xi_bln  <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb24-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb24-7"></a>    <span class="dt">change_xi_full =</span> (xi_full <span class="op">/</span><span class="st"> </span>xi_bln <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></span>
<span id="cb24-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb24-8"></a>  )</span></code></pre></div>
<p>In addition to this, we need to something very similar for importers, in order to be able to recreate figure 7 later:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb25-1"></a>ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb25-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb25-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb25-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb25-3"></a>    <span class="dt">change_imr_full =</span> <span class="op">-</span>(imr_full<span class="op">^</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>sigma)) <span class="op">/</span><span class="st"> </span>imr_bln<span class="op">^</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>sigma)) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb25-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb25-4"></a>    <span class="dt">rgdp =</span> ((y_full <span class="op">/</span><span class="st"> </span>imr_full<span class="op">^</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>sigma))) <span class="op">/</span><span class="st"> </span>(y <span class="op">/</span><span class="st"> </span>imr_bln<span class="op">^</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>sigma))) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></span>
<span id="cb25-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb25-5"></a>  )</span></code></pre></div>
</div>
<div id="figures-replication" class="section level3">
<h3><span class="header-section-number">3.1.6</span> Figures replication</h3>
<p>With all of the steps above, we are ready to create the plots from page 110. in <span class="citation">Yotov et al. (<a href="#ref-yotov2016advanced" role="doc-biblioref">2016</a>)</span>.</p>
<p>Figure 6 removes the observations where both the importer and the exporter are different, this can be seen in the original Stata code provided with the book.</p>
<p>We need to filter rows and to obtain <code>log(y)</code>:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb26-1"></a>ch2_application1 &lt;-<span class="st"> </span>ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb26-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb26-2"></a><span class="st">  </span><span class="kw">filter</span>(exporter <span class="op">==</span><span class="st"> </span>importer) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb26-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb26-3"></a><span class="st">  </span><span class="kw">select</span>(exporter, importer, y, change_xi_cfl, change_xi_full, rgdp, </span>
<span id="cb26-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb26-4"></a>         change_price_full, change_imr_full) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb26-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb26-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">log_y =</span> <span class="kw">log</span>(y))</span></code></pre></div>
<p>In addition, the original code removes Hong Kong for visualization scale purposes:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb27-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb27-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb27-2"></a><span class="st">         </span><span class="kw">filter</span>(exporter <span class="op">!=</span><span class="st"> &quot;HKG&quot;</span>)) <span class="op">+</span></span>
<span id="cb27-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb27-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> log_y, <span class="dt">y =</span> change_xi_cfl, <span class="dt">color =</span> <span class="st">&quot;1&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb27-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb27-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> log_y, <span class="dt">y =</span> change_xi_full, <span class="dt">color =</span> <span class="st">&quot;2&quot;</span>)) <span class="op">+</span></span>
<span id="cb27-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb27-5"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb27-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb27-6"></a>    <span class="dt">x =</span> <span class="st">&quot;Log value of output&quot;</span>,</span>
<span id="cb27-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb27-7"></a>    <span class="dt">y =</span> <span class="st">&quot;Percent change of exports&quot;</span>,</span>
<span id="cb27-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb27-8"></a>    <span class="dt">title =</span> <span class="st">&quot;Figure 6: Effects of abolishing international borders on exports&quot;</span>,</span>
<span id="cb27-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb27-9"></a>    <span class="dt">caption =</span> <span class="st">&quot;Source: Authors&#39; calculations&quot;</span>,</span>
<span id="cb27-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb27-10"></a>    <span class="dt">color =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb27-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb27-11"></a>  ) <span class="op">+</span></span>
<span id="cb27-12"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb27-12"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb27-13"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb27-13"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span></span>
<span id="cb27-14"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb27-14"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(</span>
<span id="cb27-15"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb27-15"></a>    <span class="dt">labels =</span> <span class="kw">c</span>(</span>
<span id="cb27-16"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb27-16"></a>      <span class="st">&quot;Conditional general equilibrium&quot;</span>,</span>
<span id="cb27-17"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb27-17"></a>      <span class="st">&quot;Full endowment general equilibrium&quot;</span></span>
<span id="cb27-18"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb27-18"></a>    ),</span>
<span id="cb27-19"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb27-19"></a>    <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#b6b8dd&quot;</span>,<span class="st">&quot;#232958&quot;</span>)</span>
<span id="cb27-20"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb27-20"></a>  )</span></code></pre></div>
<p><img src="yotover_files/figure-html/ch2_app1_figures_2-1.png" width="672" /></p>
<p>To create figure 7, we proceed in the same way as we did with figure 6:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> ch2_application1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(exporter <span class="op">!=</span><span class="st"> &quot;HKG&quot;</span>)) <span class="op">+</span></span>
<span id="cb28-2"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> log_y, <span class="dt">y =</span> change_imr_full, <span class="dt">color =</span> <span class="st">&quot;1&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb28-3"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> log_y, <span class="dt">y =</span> change_price_full, <span class="dt">color =</span> <span class="st">&quot;2&quot;</span>)) <span class="op">+</span></span>
<span id="cb28-4"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> log_y, <span class="dt">y =</span> rgdp, <span class="dt">color =</span> <span class="st">&quot;3&quot;</span>)) <span class="op">+</span></span>
<span id="cb28-5"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-5"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb28-6"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-6"></a>    <span class="dt">x =</span> <span class="st">&quot;Log value of output&quot;</span>,</span>
<span id="cb28-7"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-7"></a>    <span class="dt">y =</span> <span class="st">&quot;Percent changes&quot;</span>,</span>
<span id="cb28-8"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-8"></a>    <span class="dt">title =</span> <span class="st">&quot;Figure 7: Effects of abolishing international borders on real GDP&quot;</span>,</span>
<span id="cb28-9"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-9"></a>    <span class="dt">caption =</span> <span class="st">&quot;Note: The inward multilateral resistances have been reformulated by multiplying their value by minus one.</span><span class="ch">\n</span><span class="st">Source: Authors&#39; calculations&quot;</span>,</span>
<span id="cb28-10"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-10"></a>    <span class="dt">color =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb28-11"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-11"></a>  ) <span class="op">+</span></span>
<span id="cb28-12"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-12"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb28-13"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-13"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span></span>
<span id="cb28-14"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-14"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(</span>
<span id="cb28-15"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-15"></a>    <span class="dt">labels =</span> <span class="kw">c</span>(</span>
<span id="cb28-16"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-16"></a>      <span class="st">&quot;-(inward multilateral resistances)&quot;</span>,</span>
<span id="cb28-17"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-17"></a>      <span class="st">&quot;Factory-gate price&quot;</span>,</span>
<span id="cb28-18"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-18"></a>      <span class="st">&quot;Real GDP&quot;</span></span>
<span id="cb28-19"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-19"></a>    ),</span>
<span id="cb28-20"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-20"></a>    <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#3bade3&quot;</span>, <span class="st">&quot;#b6b8dd&quot;</span>, <span class="st">&quot;#232958&quot;</span>)</span>
<span id="cb28-21"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#cb28-21"></a>  )</span></code></pre></div>
<p><img src="yotover_files/figure-html/ch2_app1_figures_3-1.png" width="672" /></p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-yotov2016advanced">
<p>Yotov, Yoto V, Roberta Piermartini, José-Antonio Monteiro, and Mario Larch. 2016. <em>An Advanced Guide to Trade Policy Analysis: The Structural Gravity Model</em>. World Trade Organization Geneva.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

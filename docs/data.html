<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Appendix: Importing the original datasets | Solutions Manual for An Advanced Guide to Trade Policy Analysis in R</title>
  <meta name="description" content="Chapter 4 Appendix: Importing the original datasets | Solutions Manual for An Advanced Guide to Trade Policy Analysis in R" />
  <meta name="generator" content="bookdown 0.28 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Appendix: Importing the original datasets | Solutions Manual for An Advanced Guide to Trade Policy Analysis in R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Appendix: Importing the original datasets | Solutions Manual for An Advanced Guide to Trade Policy Analysis in R" />
  
  
  

<meta name="author" content="Mauricio “Pachá” Vargas Sepúlveda" />


<meta name="date" content="2022-09-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.24/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Solutions Manual for An Advanced Guide to Trade Policy Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#welcome"><i class="fa fa-check"></i><b>1.1</b> Welcome</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#disclaimer"><i class="fa fa-check"></i><b>1.2</b> Disclaimer</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#reproducing-agtpa-results-yourself"><i class="fa fa-check"></i><b>1.3</b> Reproducing AGTPA results yourself</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#getting-the-most-out-of-this-material"><i class="fa fa-check"></i><b>1.4</b> Getting the most out of this material</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i><b>1.5</b> Acknowledgments</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#changes-concerning-the-first-edition"><i class="fa fa-check"></i><b>1.6</b> Changes concerning the first edition</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#contact"><i class="fa fa-check"></i><b>1.7</b> Contact</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><i class="fa fa-check"></i><b>2</b> Partial equilibrium trade policy analysis with structural gravity</a>
<ul>
<li class="chapter" data-level="2.1" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#traditional-gravity-estimates"><i class="fa fa-check"></i><b>2.1</b> Traditional Gravity Estimates</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#preparing-the-data"><i class="fa fa-check"></i><b>2.1.1</b> Preparing the data</a></li>
<li class="chapter" data-level="2.1.2" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ols-estimation-ignoring-multilateral-resistance-terms"><i class="fa fa-check"></i><b>2.1.2</b> OLS estimation ignoring multilateral resistance terms</a></li>
<li class="chapter" data-level="2.1.3" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ols-estimation-controlling-for-multilateral-resistance-terms-with-remote-indexes"><i class="fa fa-check"></i><b>2.1.3</b> OLS estimation controlling for multilateral resistance terms with remote indexes</a></li>
<li class="chapter" data-level="2.1.4" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ols-estimation-controlling-for-multilateral-resistance-terms-with-fixed-effects"><i class="fa fa-check"></i><b>2.1.4</b> OLS estimation controlling for multilateral resistance terms with fixed effects</a></li>
<li class="chapter" data-level="2.1.5" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ppml-estimation-controlling-for-multilateral-resistance-terms-with-fixed-effects"><i class="fa fa-check"></i><b>2.1.5</b> PPML estimation controlling for multilateral resistance terms with fixed effects</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#the-distance-puzzle-resolved"><i class="fa fa-check"></i><b>2.2</b> The “distance puzzle” resolved</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#preparing-the-data-1"><i class="fa fa-check"></i><b>2.2.1</b> Preparing the data</a></li>
<li class="chapter" data-level="2.2.2" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ols-solution-for-the-distance-puzzle"><i class="fa fa-check"></i><b>2.2.2</b> OLS solution for the “distance puzzle”</a></li>
<li class="chapter" data-level="2.2.3" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ppml-solution-for-the-distance-puzzle"><i class="fa fa-check"></i><b>2.2.3</b> PPML solution for the “distance puzzle”</a></li>
<li class="chapter" data-level="2.2.4" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#internal-distance-solution-for-the-distance-puzzle"><i class="fa fa-check"></i><b>2.2.4</b> Internal distance solution for the “distance puzzle”</a></li>
<li class="chapter" data-level="2.2.5" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#internal-distance-and-home-bias-solution-for-the-distance-puzzle"><i class="fa fa-check"></i><b>2.2.5</b> Internal distance and home bias solution for the “distance puzzle”</a></li>
<li class="chapter" data-level="2.2.6" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#fixed-effects-solution-for-the-distance-puzzle"><i class="fa fa-check"></i><b>2.2.6</b> Fixed effects solution for the “distance puzzle”</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#regional-trade-agreements-effects"><i class="fa fa-check"></i><b>2.3</b> Regional trade agreements effects</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#preparing-the-data-2"><i class="fa fa-check"></i><b>2.3.1</b> Preparing the data</a></li>
<li class="chapter" data-level="2.3.2" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ols-standard-rta-estimates-with-international-trade-only"><i class="fa fa-check"></i><b>2.3.2</b> OLS standard RTA estimates with international trade only</a></li>
<li class="chapter" data-level="2.3.3" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#ppml-standard-rta-estimates-with-international-trade-only"><i class="fa fa-check"></i><b>2.3.3</b> PPML standard RTA estimates with international trade only</a></li>
<li class="chapter" data-level="2.3.4" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#addressing-potential-domestic-trade-diversion"><i class="fa fa-check"></i><b>2.3.4</b> Addressing potential domestic trade diversion</a></li>
<li class="chapter" data-level="2.3.5" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#addressing-potential-endogeneity-of-rtas"><i class="fa fa-check"></i><b>2.3.5</b> Addressing potential endogeneity of RTAs</a></li>
<li class="chapter" data-level="2.3.6" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#testing-for-potential-reverse-causality-between-trade-and-rtas"><i class="fa fa-check"></i><b>2.3.6</b> Testing for potential “reverse causality” between trade and RTAs</a></li>
<li class="chapter" data-level="2.3.7" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#addressing-potential-non-linear-and-phasing-in-effects-of-rtas"><i class="fa fa-check"></i><b>2.3.7</b> Addressing potential non-linear and phasing-in effects of RTAs</a></li>
<li class="chapter" data-level="2.3.8" data-path="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="partial-equilibrium-trade-policy-analysis-with-structural-gravity.html#addressing-globalization-effects"><i class="fa fa-check"></i><b>2.3.8</b> Addressing globalization effects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><i class="fa fa-check"></i><b>3</b> General equilibrium trade policy analysis with structural gravity</a>
<ul>
<li class="chapter" data-level="3.1" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#trade-without-borders"><i class="fa fa-check"></i><b>3.1</b> Trade without borders</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#initial-data"><i class="fa fa-check"></i><b>3.1.1</b> Initial data</a></li>
<li class="chapter" data-level="3.1.2" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-i-solve-the-baseline-model"><i class="fa fa-check"></i><b>3.1.2</b> Step I: Solve the baseline model</a></li>
<li class="chapter" data-level="3.1.3" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-ii-define-a-counterfactual-scenario"><i class="fa fa-check"></i><b>3.1.3</b> Step II: Define a counterfactual scenario</a></li>
<li class="chapter" data-level="3.1.4" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-iii-solve-the-counterfactual-model"><i class="fa fa-check"></i><b>3.1.4</b> Step III: Solve the counterfactual model</a></li>
<li class="chapter" data-level="3.1.5" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-iv-collect-construct-and-report-indexes-of-interest"><i class="fa fa-check"></i><b>3.1.5</b> Step IV: Collect, construct, and report indexes of interest</a></li>
<li class="chapter" data-level="3.1.6" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#figures-replication"><i class="fa fa-check"></i><b>3.1.6</b> Figures replication</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#impact-of-regional-trade-agreements"><i class="fa fa-check"></i><b>3.2</b> Impact of regional trade agreements</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#initial-data-1"><i class="fa fa-check"></i><b>3.2.1</b> Initial data</a></li>
<li class="chapter" data-level="3.2.2" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-1-solve-the-baseline-gravity-model"><i class="fa fa-check"></i><b>3.2.2</b> Step 1: Solve the baseline gravity model</a></li>
<li class="chapter" data-level="3.2.3" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-ii-define-a-counterfactual-scenario-1"><i class="fa fa-check"></i><b>3.2.3</b> Step II: Define a counterfactual scenario</a></li>
<li class="chapter" data-level="3.2.4" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-iii-solve-the-counterfactual-model-1"><i class="fa fa-check"></i><b>3.2.4</b> Step III: Solve the counterfactual model</a></li>
<li class="chapter" data-level="3.2.5" data-path="general-equilibrium-trade-policy-analysis-with-structural-gravity.html"><a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html#step-iv-collect-construct-and-report-indexes-of-interest-1"><i class="fa fa-check"></i><b>3.2.5</b> Step IV: Collect, construct, and report indexes of interest</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>4</b> Appendix: Importing the original datasets</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data.html"><a href="data.html#downloading-the-original-datasets"><i class="fa fa-check"></i><b>4.1</b> Downloading the original datasets</a></li>
<li class="chapter" data-level="4.2" data-path="data.html"><a href="data.html#converting-the-original-datasets"><i class="fa fa-check"></i><b>4.2</b> Converting the original datasets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://www.unescap.org/" target="blank">UN ESCAP - Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Solutions Manual for An Advanced Guide to Trade Policy Analysis in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Appendix: Importing the original datasets<a href="data.html#data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This section can be a bit obscure. It is only included to make the datasets importing steps transparent. It is important to mention that we converted the datasets from DTA (Stata, closed source format) to Arrow Parquet (cross-language, open-source).</p>
<p>The decision to use Arrow instead of CSV/TSV is that Arrow files are always read with the correct column specification (i.e., a column with values such as “00123” is always read as a string and is never confused as a numeric).</p>
<div id="downloading-the-original-datasets" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Downloading the original datasets<a href="data.html#downloading-the-original-datasets" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="data.html#cb103-1" aria-hidden="true" tabindex="-1"></a>appfiles_url <span class="ot">&lt;-</span> <span class="st">&quot;https://vi.unctad.org/tpa/web/zips/vol2/Advanced%20Guide%20to%20TPA.zip&quot;</span></span>
<span id="cb103-2"><a href="data.html#cb103-2" aria-hidden="true" tabindex="-1"></a>appfiles_zip <span class="ot">&lt;-</span> <span class="st">&quot;00-application-files.zip&quot;</span></span>
<span id="cb103-3"><a href="data.html#cb103-3" aria-hidden="true" tabindex="-1"></a>appfiles_dir <span class="ot">&lt;-</span> <span class="st">&quot;00-application-files&quot;</span></span>
<span id="cb103-4"><a href="data.html#cb103-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-5"><a href="data.html#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(appfiles_zip)) {</span>
<span id="cb103-6"><a href="data.html#cb103-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(appfiles_url, appfiles_zip)</span>
<span id="cb103-7"><a href="data.html#cb103-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-8"><a href="data.html#cb103-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-9"><a href="data.html#cb103-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(appfiles_dir)) {</span>
<span id="cb103-10"><a href="data.html#cb103-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unzip</span>(appfiles_zip)</span>
<span id="cb103-11"><a href="data.html#cb103-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.rename</span>(<span class="st">&quot;Advanced Guide to TPA&quot;</span>, appfiles_dir)</span>
<span id="cb103-12"><a href="data.html#cb103-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="converting-the-original-datasets" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Converting the original datasets<a href="data.html#converting-the-original-datasets" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="data.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># these packages are only used to import the data</span></span>
<span id="cb104-2"><a href="data.html#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb104-3"><a href="data.html#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arrow)</span>
<span id="cb104-4"><a href="data.html#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb104-5"><a href="data.html#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb104-6"><a href="data.html#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb104-7"><a href="data.html#cb104-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-8"><a href="data.html#cb104-8" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">dir.create</span>(<span class="st">&quot;data-parquet&quot;</span>, <span class="at">showWarnings =</span> F))</span>
<span id="cb104-9"><a href="data.html#cb104-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-10"><a href="data.html#cb104-10" aria-hidden="true" tabindex="-1"></a>dta_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;00-application-files&quot;</span>,</span>
<span id="cb104-11"><a href="data.html#cb104-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">pattern =</span> <span class="st">&quot;dta&quot;</span>,</span>
<span id="cb104-12"><a href="data.html#cb104-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">full.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb104-13"><a href="data.html#cb104-13" aria-hidden="true" tabindex="-1"></a>                        <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb104-14"><a href="data.html#cb104-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-15"><a href="data.html#cb104-15" aria-hidden="true" tabindex="-1"></a>read_and_clean <span class="ot">&lt;-</span> <span class="cf">function</span>(finp) {</span>
<span id="cb104-16"><a href="data.html#cb104-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(finp)</span>
<span id="cb104-17"><a href="data.html#cb104-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-18"><a href="data.html#cb104-18" aria-hidden="true" tabindex="-1"></a>  fout <span class="ot">&lt;-</span> finp <span class="sc">%&gt;%</span> </span>
<span id="cb104-19"><a href="data.html#cb104-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace</span>(appfiles_dir, <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb104-20"><a href="data.html#cb104-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace</span>(<span class="st">&quot;Chapter&quot;</span>, <span class="st">&quot;ch&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb104-21"><a href="data.html#cb104-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;Chapter[0-9]|</span><span class="sc">\\</span><span class="st">.dta&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb104-22"><a href="data.html#cb104-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-23"><a href="data.html#cb104-23" aria-hidden="true" tabindex="-1"></a>  fout <span class="ot">&lt;-</span> fout <span class="sc">%&gt;%</span> </span>
<span id="cb104-24"><a href="data.html#cb104-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;(/)&quot;</span>, <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb104-25"><a href="data.html#cb104-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">make_clean_names</span>()</span>
<span id="cb104-26"><a href="data.html#cb104-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-27"><a href="data.html#cb104-27" aria-hidden="true" tabindex="-1"></a>  long_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb104-28"><a href="data.html#cb104-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;datasets_&quot;</span>,</span>
<span id="cb104-29"><a href="data.html#cb104-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;applications_&quot;</span>,</span>
<span id="cb104-30"><a href="data.html#cb104-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;exercises_&quot;</span>,</span>
<span id="cb104-31"><a href="data.html#cb104-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;1_trade_without_border_results_1&quot;</span>,</span>
<span id="cb104-32"><a href="data.html#cb104-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;2_rt_as_effects_results_2_&quot;</span></span>
<span id="cb104-33"><a href="data.html#cb104-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb104-34"><a href="data.html#cb104-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-35"><a href="data.html#cb104-35" aria-hidden="true" tabindex="-1"></a>  fout <span class="ot">&lt;-</span> fout <span class="sc">%&gt;%</span> </span>
<span id="cb104-36"><a href="data.html#cb104-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="fu">paste</span>(long_names, <span class="at">collapse =</span> <span class="st">&quot;|&quot;</span>), <span class="st">&quot;&quot;</span>)</span>
<span id="cb104-37"><a href="data.html#cb104-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-38"><a href="data.html#cb104-38" aria-hidden="true" tabindex="-1"></a>  fout <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(fout, <span class="st">&quot;_([0-9])_|__&quot;</span>, <span class="st">&quot;_&quot;</span>)</span>
<span id="cb104-39"><a href="data.html#cb104-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-40"><a href="data.html#cb104-40" aria-hidden="true" tabindex="-1"></a>  fout2 <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;data-parquet/%s.parquet&quot;</span>, fout)</span>
<span id="cb104-41"><a href="data.html#cb104-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-42"><a href="data.html#cb104-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(fout2)) {</span>
<span id="cb104-43"><a href="data.html#cb104-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_dta</span>(finp) <span class="sc">%&gt;%</span> </span>
<span id="cb104-44"><a href="data.html#cb104-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb104-45"><a href="data.html#cb104-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write_parquet</span>(fout2)</span>
<span id="cb104-46"><a href="data.html#cb104-46" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb104-47"><a href="data.html#cb104-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb104-48"><a href="data.html#cb104-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-49"><a href="data.html#cb104-49" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(dta_files, read_and_clean)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="general-equilibrium-trade-policy-analysis-with-structural-gravity.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
